{% extends "base.html" %}

{% block extra_head %}
<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤ */
    .status-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }
    
    .status-–∑–∞–≤–µ—Ä—à–µ–Ω {
        background-color: #d1edff;
        color: #0c5460;
        border: 1px solid #b8daff;
    }
    
    .status-–æ—Ç–º–µ–Ω–µ–Ω {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
    .main__subheader-tabs button.active {
        background-color: #007bff;
        color: white;
        border-color: #007bff;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
    .order-row:hover {
        background-color: #f8f9fa;
    }
    
    .status-cell {
        text-align: center;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }
    
    .empty-state img {
        width: 48px;
        height: 48px;
        opacity: 0.5;
        margin-bottom: 16px;
    }
    
    .empty-state p {
        margin: 0;
        font-size: 16px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
    #main-map-container {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        position: relative;
    }
    
    /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã */
    #main-map-container:empty::before {
        content: "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #6c757d;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è –î–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–∞—è - taxi.wazir.kg{% endblock %}

{% block header_title %}{% endblock %}

{% block header_right %}
<div class="main__header-search">
    <div class="main__header-search-item">
        <form action="#">
            <input type="search" placeholder="–ü–æ–∏—Å–∫" id="header-search"
                value="{{ search|default('') }}">
            <button><img
                    src="{{ url_for('static', path='/assets/img/ico/search.png') }}"
                    alt="search"></button>
        </form>
    </div>
    <div class="main__header-search-profile">
        <div class="main__header-search-profile-item">
            <a href="#"><img
                    src="{{ url_for('static', path='/assets/img/ico/notif.png') }}"
                    alt="notif"></a>
        </div>
        <div class="main__header-search-profile-item">
            <a href="#"><img
                    src="{{ url_for('static', path='/assets/img/ico/user.png') }}"
                    alt="profile"></a>
        </div>
    </div>
</div>
{% endblock %}

{% block subheader %}
<div class="main__subheader">
    <div class="main__subheader-filter">
        <a href="#"><img
                src="{{ url_for('static', path='/assets/img/ico/burger.png') }}"
                alt="burger"></a>
        <a href="#"><img
                src="{{ url_for('static', path='/assets/img/ico/chart.png') }}"
                alt="chart"></a>
        <a href="#"><img
                src="{{ url_for('static', path='/assets/img/ico/earth.png') }}"
                alt="earth"></a>
    </div>
    <div class="main__subheader-filing">
        <form action="#">
            <select name="filing-date" id="date-filter">
                <option value="all" {% if not date_filter %}selected{% endif
                    %}>–î–∞—Ç–∞ –ø–æ–¥–∞—á–∏</option>
                {% for date in available_dates %}
                <option value="{{ date }}" {% if date_filter == date
                    %}selected{% endif %}>{{ date }}</option>
                {% endfor %}
            </select>
        </form>
    </div>
    <div class="main__subheader-date">
        <div class="date-range-selector">
            <input type="text" id="date-range-display" readonly
                placeholder="–¥–¥.–º–º.–≥–≥–≥–≥ - –¥–¥.–º–º.–≥–≥–≥–≥"
                value="{{ start_date|default('') + ' - ' + end_date|default('') if start_date and end_date else '' }}">
            <input type="hidden" name="start_date" id="start-date"
                value="{{ start_date|default('') }}">
            <input type="hidden" name="end_date" id="end-date"
                value="{{ end_date|default('') }}">
            <button type="button" id="clear-dates"
                title="–û—á–∏—Å—Ç–∏—Ç—å –¥–∞—Ç—ã">√ó</button>
        </div>
    </div>
    <div class="main__subheader-add">
        <button><a href="{{ url_for('disp_new_order') }}"> + –ù–æ–≤—ã–π
                (F2)</a></button>
        <button id="filter-free"
            class="{% if status_filter == '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è' %}active{% endif %}">
            <span class="executing"></span>
            –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
        </button>
        <button id="filter-busy"
            class="{% if status_filter == '–ó–∞–≤–µ—Ä—à–µ–Ω' %}active{% endif %}">
            <span class="completed"></span>
            –ó–∞–≤–µ—Ä—à–µ–Ω
        </button>
        <button id="filter-cancelled"
            class="{% if status_filter == '–û—Ç–º–µ–Ω–µ–Ω' %}active{% endif %}">
            <span class="cancelled"></span>
            –û—Ç–º–µ–Ω–µ–Ω
        </button>
        {% if is_filtered %}
        <button id="reset-filters" class="main__btn-short">–°–±—Ä–æ—Å–∏—Ç—å
            —Ñ–∏–ª—å—Ç—Ä—ã</button>
        {% endif %}
    </div>
    <div class="main__subheader-balance">
        <img src="{{ url_for('static', path='/assets/img/ico/balance.png') }}"
            alt="balance">
        <p>
            –ë–∞–ª–∞–Ω—Å: {{ total_balance|default('0') }}
        </p>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="main__table">
    <table>
        <thead>
            <tr>
                <th>–ó–∞–∫–∞–∑</th>
                <th>–î–∞—Ç–∞</th>
                <th>–í—Ä–µ–º—è</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–û—Ç–∫—É–¥–∞</th>
                <th>–ö—É–¥–∞</th>
                <th>–ü–æ–∑—ã–≤–Ω–æ–π</th>
                <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                <th>–¢–∞—Ä–∏—Ñ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
        </thead>
        <tbody id="orders-table-body">
            {% if orders %}
            {% for order in orders %}
            <tr class="order-row" data-id="{{ order.id }}">
                <td>{{ order.order_number|default(order.id) }}</td>
                <td>{{ order.created_at.strftime('%d.%m.%y') }}</td>
                <td>{{ order.time }}</td>
                <td>{{ order.driver.phone|default('+996 XXX XX-XX-XX') }}</td>
                <td>{{ order.origin }}</td>
                <td>{{ order.destination }}</td>
                <td>{{ order.driver.callsign }}</td>
                <td>{{ order.price|default('') }}</td>
                <td>{{ order.tariff|default(order.driver.tariff) }}</td>
                <td class="status-cell">
                    <span class="status-badge status-{{ order.status|lower|replace(' ', '-')|replace('—ë', '–µ') }}">
                        {{ order.status|default('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è') }}
                    </span>
                </td>
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="10" class="no-data">
                    <div class="empty-state">
                        <img
                            src="{{ url_for('static', path='/assets/img/ico/car.png') }}"
                            alt="–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤">
                        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
                    </div>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
    <div class="main__table-footer">
        <div class="main__table-driver">
            <button>–í–æ–¥–∏—Ç–µ–ª–∏: {{ total_drivers|default('0') }}</button>
        </div>
        <div class="main__table-pagination">
            <div class="main__table-pagination-prev">
                <button {% if page == 1 %}disabled{% endif %}><img
                        src="{{ url_for('static', path='/assets/img/ico/prev.png') }}"
                        alt="prev"></button>
            </div>
            {% for p in range(1, total_pages + 1) %}
            <div
                class="main__table-pagination-{% if p == page %}active{% endif %} main__table-pagination-item">
                <button>{{ p }}</button>
            </div>
            {% endfor %}
            <div class="main__table-pagination-next">
                <button {% if page == total_pages %}disabled{% endif %}><img
                        src="{{ url_for('static', path='/assets/img/ico/next.png') }}"
                        alt="next"></button>
            </div>
        </div>
    </div>
</div>

<div class="main__map">
    <div id="main-map-container" style="width: 100%; height: 400px; border-radius: 8px; overflow: hidden;"></div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Google Maps JS API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key or '' }}&libraries=places&v=weekly"></script>

<script>
    $(document).ready(function() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Maps —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ API
        function waitForGoogleMaps() {
            if (window.google && window.google.maps) {
                initMainMap();
            } else {
                console.log('‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ Google Maps API...');
                setTimeout(waitForGoogleMaps, 100);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
        function initMainMap() {
            try {
                console.log('üó∫Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Maps...');
                
                const mapContainer = document.getElementById('main-map-container');
                if (!mapContainer) {
                    console.warn('‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–∞—Ä—Ç–∞ —É–∂–µ
                if (window.mainMapInstance) {
                    console.log('‚ÑπÔ∏è –ö–∞—Ä—Ç–∞ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                    return;
                }
                
                // –¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞ –û—à, –ö–∏—Ä–≥–∏–∑–∏—è
                const oshCenter = { lat: 40.5138, lng: 72.8019 };
                
                // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
                window.mainMapInstance = new google.maps.Map(mapContainer, {
                    center: oshCenter,
                    zoom: 12,
                    gestureHandling: 'greedy',
                    mapTypeControl: false,
                    streetViewControl: false,
                    fullscreenControl: false
                });
                
                console.log('‚úÖ Google Maps —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –¥–ª—è –∫–∞—Ä—Ç—ã
                loadOrdersForMap();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google Maps:', error);
                // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(waitForGoogleMaps, 2000);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É
        function addOrdersToMap(map, orders) {
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã
            if (window.mapMarkers) {
                window.mapMarkers.forEach(marker => marker.setMap(null));
            }
            if (window.mapDirections) {
                window.mapDirections.forEach(renderer => renderer.setMap(null));
            }
            window.mapMarkers = [];
            window.mapDirections = [];
            
            const geocoder = new google.maps.Geocoder();
            const directionsService = new google.maps.DirectionsService();
            let processedCount = 0;
            
            console.log('üó∫Ô∏è –ù–∞—á–∏–Ω–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É...');
            
            orders.forEach((order, index) => {
                console.log(`üìç –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–∫–∞–∑ ${order.order_number}: ${order.origin} ‚Üí ${order.destination}`);
                
                // –ì–µ–æ–∫–æ–¥–∏—Ä—É–µ–º –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                geocoder.geocode({ 
                    address: order.origin + ', –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω',
                    region: 'KG'
                }, (results, status) => {
                    if (status === google.maps.GeocoderStatus.OK && results.length > 0) {
                        const originLocation = results[0].geometry.location;
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –º–∞—Ä–∫–µ—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É
                        let markerColor = '#fdcb6e'; // –∂–µ–ª—Ç—ã–π –¥–ª—è "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è"
                        if (order.status === '–ó–∞–≤–µ—Ä—à–µ–Ω') markerColor = '#00b894'; // –∑–µ–ª–µ–Ω—ã–π
                        else if (order.status === '–û—Ç–º–µ–Ω–µ–Ω') markerColor = '#e17055'; // –∫—Ä–∞—Å–Ω—ã–π
                        
                        // –°–æ–∑–¥–∞—ë–º –º–∞—Ä–∫–µ—Ä –¥–ª—è –º–µ—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        const originMarker = new google.maps.Marker({
                            position: originLocation,
                            map: map,
                            title: `–ó–∞–∫–∞–∑ ${order.order_number} - –û—Ç–∫—É–¥–∞`,
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 10,
                                fillColor: markerColor,
                                fillOpacity: 1,
                                strokeColor: '#FFFFFF',
                                strokeWeight: 3
                            }
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                        window.mapMarkers.push(originMarker);
                        
                        // –ò–Ω—Ñ–æ-–æ–∫–Ω–æ –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
                        const infoWindow = new google.maps.InfoWindow({
                            content: `
                                <div style="padding: 12px; font-family: Arial, sans-serif; min-width: 250px;">
                                    <h4 style="margin: 0 0 8px 0; color: #333;">–ó–∞–∫–∞–∑ ${order.order_number}</h4>
                                    <p style="margin: 4px 0;"><strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="color: ${markerColor}; font-weight: bold;">${order.status}</span></p>
                                    <p style="margin: 4px 0;"><strong>–í—Ä–µ–º—è:</strong> ${order.time}</p>
                                    <p style="margin: 4px 0;"><strong>–û—Ç–∫—É–¥–∞:</strong> ${order.origin}</p>
                                    <p style="margin: 4px 0;"><strong>–ö—É–¥–∞:</strong> ${order.destination}</p>
                                    <p style="margin: 4px 0;"><strong>–í–æ–¥–∏—Ç–µ–ª—å:</strong> ${order.driver_name}</p>
                                    ${order.driver_phone ? `<p style="margin: 4px 0;"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.driver_phone}</p>` : ''}
                                    ${order.price ? `<p style="margin: 4px 0;"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${order.price} —Å–æ–º</p>` : ''}
                                    ${order.tariff ? `<p style="margin: 4px 0;"><strong>–¢–∞—Ä–∏—Ñ:</strong> ${order.tariff}</p>` : ''}
                                </div>
                            `
                        });
                        
                        originMarker.addListener('click', () => {
                            infoWindow.open(map, originMarker);
                        });
                        
                        // –ï—Å–ª–∏ –∑–∞–∫–∞–∑ –∞–∫—Ç–∏–≤–µ–Ω (–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è), —Å—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç
                        if (order.status === '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è') {
                            console.log(`üöó –°—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ ${order.order_number}`);
                            
                            geocoder.geocode({ 
                                address: order.destination + ', –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω',
                                region: 'KG'
                            }, (destResults, destStatus) => {
                                if (destStatus === google.maps.GeocoderStatus.OK && destResults.length > 0) {
                                    const destinationLocation = destResults[0].geometry.location;
                                    
                                    // –ú–∞—Ä–∫–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
                                    const destinationMarker = new google.maps.Marker({
                                        position: destinationLocation,
                                        map: map,
                                        title: `–ó–∞–∫–∞–∑ ${order.order_number} - –ö—É–¥–∞`,
                                        icon: {
                                            path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                                            scale: 8,
                                            fillColor: markerColor,
                                            fillOpacity: 1,
                                            strokeColor: '#FFFFFF',
                                            strokeWeight: 2
                                        }
                                    });
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –≤ –º–∞—Å—Å–∏–≤
                                    window.mapMarkers.push(destinationMarker);
                                    
                                    // –°—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç
                                    const directionsRenderer = new google.maps.DirectionsRenderer({
                                        suppressMarkers: true,
                                        polylineOptions: {
                                            strokeColor: markerColor,
                                            strokeWeight: 5,
                                            strokeOpacity: 0.8
                                        }
                                    });
                                    directionsRenderer.setMap(map);
                                    
                                    // –î–æ–±–∞–≤–ª—è–µ–º renderer –≤ –º–∞—Å—Å–∏–≤
                                    window.mapDirections.push(directionsRenderer);
                                    
                                    directionsService.route({
                                        origin: originLocation,
                                        destination: destinationLocation,
                                        travelMode: google.maps.TravelMode.DRIVING
                                    }, (response, status) => {
                                        if (status === google.maps.DirectionsStatus.OK) {
                                            directionsRenderer.setDirections(response);
                                            console.log(`‚úÖ –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∑–∞–∫–∞–∑–∞ ${order.order_number}`);
                                        } else {
                                            console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∑–∞–∫–∞–∑–∞ ${order.order_number}:`, status);
                                        }
                                    });
                                } else {
                                    console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∑–∞–∫–∞–∑–∞ ${order.order_number}:`, order.destination);
                                }
                            });
                        }
                        
                        processedCount++;
                        console.log(`‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω –∑–∞–∫–∞–∑ ${order.order_number} (${processedCount}/${orders.length})`);
                        
                        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –º–∞—Ä–∫–µ—Ä, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –Ω–µ–º
                        if (processedCount === 1) {
                            map.setCenter(originLocation);
                            map.setZoom(13);
                        }
                        
                    } else {
                        console.warn(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –¥–ª—è –∑–∞–∫–∞–∑–∞ ${order.order_number}:`, order.origin, status);
                    }
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∫–∞—Ä—Ç—ã
        function loadOrdersForMap() {
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –¥–ª—è –∫–∞—Ä—Ç—ã...');
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const apiParams = new URLSearchParams();
            
            if (urlParams.has('status')) apiParams.set('status', urlParams.get('status'));
            if (urlParams.has('search')) apiParams.set('search', urlParams.get('search'));
            if (urlParams.has('date')) apiParams.set('date', urlParams.get('date'));
            if (urlParams.has('start_date')) apiParams.set('start_date', urlParams.get('start_date'));
            if (urlParams.has('end_date')) apiParams.set('end_date', urlParams.get('end_date'));
            
            fetch(`/api/orders/map?${apiParams.toString()}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.orders) {
                        console.log('üìä –ü–æ–ª—É—á–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∫–∞—Ä—Ç—ã:', data.orders.length);
                        if (data.orders.length > 0) {
                            addOrdersToMap(window.mainMapInstance, data.orders);
                        } else {
                            console.log('‚ÑπÔ∏è –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ');
                        }
                    } else {
                        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', data.error);
                    }
                })
                .catch(error => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∫–∞—Ä—Ç—ã:', error);
                });
        }
        
        // –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        let datePickerVisible = false;
        let selectedStartDate = $('#start-date').val() ? new Date($('#start-date').val()) : null;
        let selectedEndDate = $('#end-date').val() ? new Date($('#end-date').val()) : null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
        function formatDate(date) {
            if (!date) return '';
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
        function toISODateString(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞—Ç
        function updateDateDisplay() {
            if (selectedStartDate && selectedEndDate) {
                $('#date-range-display').val(`${formatDate(selectedStartDate)} - ${formatDate(selectedEndDate)}`);
                $('#start-date').val(toISODateString(selectedStartDate));
                $('#end-date').val(toISODateString(selectedEndDate));
            } else {
                $('#date-range-display').val('');
                $('#start-date').val('');
                $('#end-date').val('');
            }
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        function toggleCalendar() {
            if (datePickerVisible) {
                $('.date-picker-wrapper').remove();
                datePickerVisible = false;
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
            const datePickerHtml = `
                <div class="date-picker-wrapper">
                    <div class="date-header">
                        <div class="month-selector">
                            <button class="prev-month">&lt;</button>
                            <div class="month-title">${new Date(currentYear, currentMonth).toLocaleString('ru', { month: 'long', year: 'numeric' })}</div>
                            <button class="next-month">&gt;</button>
                        </div>
                    </div>
                    <div class="date-range-info">
                        ${!selectedStartDate && !selectedEndDate ? '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç' : 
                           selectedStartDate && !selectedEndDate ? '–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ' + formatDate(selectedStartDate) : 
                           '–î–∏–∞–ø–∞–∑–æ–Ω: ' + formatDate(selectedStartDate) + ' - ' + formatDate(selectedEndDate)}
                    </div>
                    <div class="calendar">
                        <div class="day-header">–ü–Ω</div>
                        <div class="day-header">–í—Ç</div>
                        <div class="day-header">–°—Ä</div>
                        <div class="day-header">–ß—Ç</div>
                        <div class="day-header">–ü—Ç</div>
                        <div class="day-header">–°–±</div>
                        <div class="day-header">–í—Å</div>
                        ${generateDays()}
                    </div>
                    <div class="controls">
                        <button class="apply-dates">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                        <button class="cancel-dates">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            
            $('.date-range-selector').append(datePickerHtml);
            datePickerVisible = true;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            $('.prev-month').click(function(e) {
                e.stopPropagation();
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateCalendar();
            });
            
            $('.next-month').click(function(e) {
                e.stopPropagation();
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateCalendar();
            });
            
            // –í—ã–±–æ—Ä –¥–∞—Ç
            $('.day:not(.disabled)').click(function(e) {
                e.stopPropagation();
                const day = parseInt($(this).text());
                const date = new Date(currentYear, currentMonth, day);
                
                if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                    // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä
                    selectedStartDate = date;
                    selectedEndDate = null;
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É
                    if (date < selectedStartDate) {
                        selectedEndDate = selectedStartDate;
                        selectedStartDate = date;
                    } else {
                        selectedEndDate = date;
                    }
                }
                
                updateCalendar();
                updateRangeInfo();
            });
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ –≤—ã–±–æ—Ä–∞
            $('.apply-dates').click(function(e) {
                e.stopPropagation();
                updateDateDisplay();
                $('.date-picker-wrapper').remove();
                datePickerVisible = false;
                
                // –ï—Å–ª–∏ –æ–±–µ –¥–∞—Ç—ã –≤—ã–±—Ä–∞–Ω—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                if (selectedStartDate && selectedEndDate) {
                    filterOrders();
                }
            });
            
            $('.cancel-dates').click(function(e) {
                e.stopPropagation();
                $('.date-picker-wrapper').remove();
                datePickerVisible = false;
            });
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ –∫–ª–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            $('.date-picker-wrapper').click(function(e) {
                e.stopPropagation();
            });
        }
        
        function updateRangeInfo() {
            let infoText = '';
            if (!selectedStartDate && !selectedEndDate) {
                infoText = '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç';
            } else if (selectedStartDate && !selectedEndDate) {
                infoText = '–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: ' + formatDate(selectedStartDate);
            } else {
                infoText = '–î–∏–∞–ø–∞–∑–æ–Ω: ' + formatDate(selectedStartDate) + ' - ' + formatDate(selectedEndDate);
            }
            $('.date-range-info').text(infoText);
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–Ω–µ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function generateDays() {
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è (0 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ...)
            let firstDayOfWeek = firstDay.getDay();
            firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1; // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç (0 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ..., 6 - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
            
            let html = '';
            
            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞
            for (let i = 0; i < firstDayOfWeek; i++) {
                html += '<div class="day disabled"></div>';
            }
            
            // –î–Ω–∏ –º–µ—Å—è—Ü–∞
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const isSelected = selectedStartDate && day === selectedStartDate.getDate() && 
                                currentMonth === selectedStartDate.getMonth() && 
                                currentYear === selectedStartDate.getFullYear();
                const isEndSelected = selectedEndDate && day === selectedEndDate.getDate() && 
                                  currentMonth === selectedEndDate.getMonth() && 
                                  currentYear === selectedEndDate.getFullYear();
                const isInRange = selectedStartDate && selectedEndDate && 
                             date > selectedStartDate && date < selectedEndDate;
                
                let classes = 'day';
                if (isSelected || isEndSelected) classes += ' selected';
                if (isInRange) classes += ' in-range';
                
                html += `<div class="${classes}">${day}</div>`;
            }
            
            return html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        function updateCalendar() {
            $('.month-title').text(new Date(currentYear, currentMonth).toLocaleString('ru', { month: 'long', year: 'numeric' }));
            $('.calendar .day').remove();
            $('.calendar').append(generateDays());
            
            // –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            $('.day:not(.disabled)').click(function(e) {
                e.stopPropagation();
                const day = parseInt($(this).text());
                const date = new Date(currentYear, currentMonth, day);
                
                if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                    // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –≤—ã–±–æ—Ä
                    selectedStartDate = date;
                    selectedEndDate = null;
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É
                    if (date < selectedStartDate) {
                        selectedEndDate = selectedStartDate;
                        selectedStartDate = date;
                    } else {
                        selectedEndDate = date;
                    }
                }
                
                updateCalendar();
                updateRangeInfo();
            });
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ –ø–æ–ª–µ –¥–∞—Ç—ã
        $('#date-range-display').click(function(e) {
            e.stopPropagation();
            toggleCalendar();
        });
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        $(document).click(function() {
            if (datePickerVisible) {
                $('.date-picker-wrapper').remove();
                datePickerVisible = false;
            }
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –¥–∞—Ç
        $('#clear-dates').click(function(e) {
            e.stopPropagation();
            selectedStartDate = null;
            selectedEndDate = null;
            updateDateDisplay();
            
            // –£–¥–∞–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—Ç –∏–∑ URL –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const params = new URLSearchParams(window.location.search);
            params.delete('start_date');
            params.delete('end_date');
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö
            if (params.toString()) {
                window.location.href = window.location.pathname + '?' + params.toString();
            } else {
                window.location.href = window.location.pathname;
            }
        });

        // –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–∫–∞–∑–æ–≤
        function filterOrders() {
            console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∑–∞–∫–∞–∑–æ–≤...');
            
            const searchValue = $('#header-search').val().toLowerCase();
            const statusFilter = getActiveStatusFilter();
            const dateFilter = $('#date-filter').val();
            const startDate = $('#start-date').val();
            const endDate = $('#end-date').val();
            
            console.log('üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', {
                search: searchValue,
                status: statusFilter,
                date: dateFilter,
                startDate: startDate,
                endDate: endDate
            });
            
            // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const params = new URLSearchParams(window.location.search);
            
            if (searchValue) {
                params.set('search', searchValue);
            } else {
                params.delete('search');
            }
            
            if (statusFilter) {
                params.set('status', statusFilter);
            } else {
                params.delete('status');
            }
            
            if (dateFilter && dateFilter !== 'all') {
                params.set('date', dateFilter);
            } else {
                params.delete('date');
            }
            
            if (startDate) {
                params.set('start_date', startDate);
            } else {
                params.delete('start_date');
            }
            
            if (endDate) {
                params.set('end_date', endDate);
            } else {
                params.delete('end_date');
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (params.has('page')) {
                const currentPage = params.get('page');
                params.set('page', currentPage);
            } else {
                params.set('page', '1');
            }
            
            const newUrl = window.location.pathname + '?' + params.toString();
            console.log('üåê –ù–æ–≤—ã–π URL:', newUrl);
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ URL —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
            window.location.href = newUrl;
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
        function getActiveStatusFilter() {
            if ($('#filter-free').hasClass('active')) {
                return '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è';
            } else if ($('#filter-busy').hasClass('active')) {
                return '–ó–∞–≤–µ—Ä—à–µ–Ω';
            } else if ($('#filter-cancelled').hasClass('active')) {
                return '–û—Ç–º–µ–Ω–µ–Ω';
            }
            return null;
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        $('#header-search').on('keypress', function(e) {
            if (e.which === 13) {
                filterOrders();
                e.preventDefault();
            }
        });
        
        $('#date-filter').on('change', function() {
            filterOrders();
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        $('#filter-free, #filter-busy, #filter-cancelled').on('click', function() {
            console.log('üîò –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞:', $(this).attr('id'));
            
            // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞, –æ—Ç–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä
            if ($(this).hasClass('active')) {
                console.log('üîÑ –û—Ç–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä');
                $(this).removeClass('active');
            } else {
                // –ò–Ω–∞—á–µ —Å–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
                console.log('üîõ –í–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä');
                $('#filter-free, #filter-busy, #filter-cancelled').removeClass('active');
                $(this).addClass('active');
            }
            
            const activeFilter = getActiveStatusFilter();
            console.log('üìä –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä:', activeFilter);
            
            filterOrders();
        });
        
        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        $('#reset-filters').on('click', function() {
            window.location.href = window.location.pathname;
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        $('.main__table-pagination-item button').click(function() {
            const page = $(this).text();
            const params = new URLSearchParams(window.location.search);
            params.set('page', page);
            window.location.href = window.location.pathname + '?' + params.toString();
        });
        
        $('.main__table-pagination-prev button').click(function() {
            if (!$(this).prop('disabled')) {
                const currentPage = parseInt($('.main__table-pagination-active button').text());
                const params = new URLSearchParams(window.location.search);
                params.set('page', currentPage - 1);
                window.location.href = window.location.pathname + '?' + params.toString();
            }
        });
        
        $('.main__table-pagination-next button').click(function() {
            if (!$(this).prop('disabled')) {
                const currentPage = parseInt($('.main__table-pagination-active button').text());
                const params = new URLSearchParams(window.location.search);
                params.set('page', currentPage + 1);
                window.location.href = window.location.pathname + '?' + params.toString();
            }
        });

        $('<style>')
            .prop('type', 'text/css')
            .html(`
                .date-range-selector {
                    position: relative;
                    display: flex;
                    align-items: center;
                }
                
                #date-range-display {
                    width: 200px;
                    padding: 14px 30px;
                    cursor: pointer;
                    background: #47484c;
                    color: white;
                    border: 1px solid #333;
                    border-radius: 4px;
                    font-size: 14px;
                }
                
                #clear-dates {
                    position: absolute;
                    right: 8px;
                    background: none;
                    border: none;
                    color: #999;
                    cursor: pointer;
                    font-size: 18px;
                    padding: 0 5px;
                    line-height: 1;
                }
                
                #clear-dates:hover {
                    color: white;
                }
                
                .date-picker-wrapper {
                    position: absolute;
                    z-index: 9999;
                    background: #252525;
                    border: 1px solid #333;
                    border-radius: 4px;
                    padding: 15px;
                    color: white;
                    top: 42px;
                    left: 0;
                    width: 280px;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                    font-family: Arial, sans-serif;
                }
                
                .date-picker-wrapper .date-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                    padding-bottom: 8px;
                    border-bottom: 1px solid #333;
                }
                
                .date-picker-wrapper .month-selector {
                    display: flex;
                    align-items: center;
                    width: 100%;
                    justify-content: space-between;
                }
                
                .date-picker-wrapper .month-selector button {
                    background: #333;
                    border: none;
                    color: white;
                    cursor: pointer;
                    font-size: 16px;
                    width: 30px;
                    height: 30px;
                    border-radius: 4px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: background-color 0.2s;
                }
                
                .date-picker-wrapper .month-selector button:hover {
                    background: #444;
                }
                
                .date-picker-wrapper .month-title {
                    font-weight: bold;
                    font-size: 14px;
                    text-align: center;
                    text-transform: capitalize;
                }
                
                .date-picker-wrapper .calendar {
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 2px;
                    margin-bottom: 12px;
                }
                
                .date-picker-wrapper .day-header {
                    text-align: center;
                    font-weight: bold;
                    padding: 4px 0;
                    color: #888;
                    font-size: 12px;
                }
                
                .date-picker-wrapper .day {
                    text-align: center;
                    padding: 6px 0;
                    cursor: pointer;
                    border-radius: 4px;
                    font-size: 13px;
                    transition: background-color 0.2s;
                }
                
                .date-picker-wrapper .day:hover {
                    background: #333;
                }
                
                .date-picker-wrapper .day.selected {
                    background: #007bff;
                    color: white;
                }
                
                .date-picker-wrapper .day.in-range {
                    background: rgba(0, 123, 255, 0.2);
                }
                
                .date-picker-wrapper .day.disabled {
                    color: #444;
                    cursor: not-allowed;
                }
                
                .date-picker-wrapper .controls {
                    display: flex;
                    justify-content: space-between;
                    margin-top: 10px;
                    padding-top: 8px;
                    border-top: 1px solid #333;
                }
                
                .date-picker-wrapper .controls button {
                    padding: 6px 12px;
                    background: #333;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                    font-size: 13px;
                }
                
                .date-picker-wrapper .controls button.apply-dates {
                    background: #007bff;
                }
                
                .date-picker-wrapper .controls button:hover {
                    background: #444;
                }
                
                .date-picker-wrapper .controls button.apply-dates:hover {
                    background: #0069d9;
                }
                
                .date-range-info {
                    margin-bottom: 8px;
                    font-size: 12px;
                    color: #bbb;
                    text-align: center;
                }
                
                /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö –±–µ–π–¥–∂–µ–π */
                .status-cell {
                    text-align: center;
                }
                
                .status-badge {
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 500;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .status-–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è {
                    background-color: #ffeaa7;
                    color: #d63031;
                    border: 1px solid #fdcb6e;
                }
                
                .status-–∑–∞–≤–µ—Ä—à–µ–Ω {
                    background-color: #00b894;
                    color: white;
                    border: 1px solid #00a085;
                }
                
                .status-–æ—Ç–º–µ–Ω–µ–Ω {
                    background-color: #e17055;
                    color: white;
                    border: 1px solid #d63031;
                }
                
                /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
                .executing {
                    background-color: #fdcb6e;
                }
                
                .completed {
                    background-color: #00b894;
                }
                
                .cancelled {
                    background-color: #e17055;
                }
            `)
            .appendTo('head');
    });
</script>
{% endblock %}