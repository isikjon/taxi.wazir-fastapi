{% extends "base.html" %}
{% block header_title %}–ù–æ–≤—ã–π –∑–∞–∫–∞–∑{% endblock %}

{% block content %}
<div class="main__order-wrapper">
    <form id="order-form" method="post" action="/api/orders/">
        <div class="main__order-wrapper-blocks">
            <div class="main__order-settings">
                <div class="main__order-header">
                    <div class="main__order-header-item">
                        <p>–ó–∞–∫–∞–∑ ‚Ññ</p>
                        <input type="text" id="order-number" name="order_number" readonly class="main__btn-short" value="{{ order_number }}">
                    </div>
                    <div class="main__order-header-item">
                        <p>–î–∞—Ç–∞ –≤—Ä–µ–º—è</p>
                        <input type="text" id="order-date" name="order_date" readonly class="main__btn-short" value="{{ now.strftime('%d.%m.%y') }}">
                        <input type="text" id="order-time" name="order_time" readonly class="main__btn-short" value="{{ now.strftime('%H:%M') }}">
                    </div>
                    <div class="main__order-header-item">
                        <p>–ü—É—Ç–µ–≤–æ–π –ª–∏—Å—Ç</p>
                        <input type="text" id="route-number" name="route_number" readonly class="main__btn-short" value="{{ route_number }}">
                    </div>
                </div>
                <div class="main__order-subheader">
                    <div class="main__order-subheader-item">
                        <select id="driver-select" name="driver_id" class="main__btn-short">
                            <option value disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è</option>
                            {% for driver in drivers %}
                            <option value="{{ driver.id }}" data-phone="{{ driver.phone|default('+996 (XXX) XX-XX-XX') }}" data-tariff="{{ driver.tariff }}">
                                {{ driver.full_name }}
                            </option>
                            {% endfor %}
                        </select>
                        <input type="text" id="driver-phone" readonly class="main__btn-short" value="+996 (XXX) XX-XX-XX">
                    </div>
                    <div class="main__order-subheader-item">
                        <div class="main__subheader-filing">
                            <select id="tariff-select" name="tariff">
                                <option value disabled selected>–í–∞—Ä–∏–∞–Ω—Ç</option>
                                <option value="–≠–∫–æ–Ω–æ–º">–≠–∫–æ–Ω–æ–º</option>
                                <option value="–ö–æ–º—Ñ–æ—Ä—Ç">–ö–æ–º—Ñ–æ—Ä—Ç</option>
                                <option value="–ö–æ–º—Ñ–æ—Ä—Ç+">–ö–æ–º—Ñ–æ—Ä—Ç+</option>
                                <option value="–ë–∏–∑–Ω–µ—Å">–ë–∏–∑–Ω–µ—Å</option>
                            </select>
                        </div>
                        <div class="main__subheader-filing">
                            <select id="payment-method" name="payment_method">
                                <option value disabled selected>–û–ø–ª–∞—Ç–∞</option>
                                <option value="–ù–∞–ª–∏—á–Ω—ã–µ">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                                <option value="–ù–∞ –∫–∞—Ä—Ç—É">–ù–∞ –∫–∞—Ä—Ç—É</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="main__order-details">
                    <div class="main__order-details-item main__order-details-where">
                        <input type="text" id="origin-address" name="origin" placeholder="–û—Ç–∫—É–¥–∞ (–∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è)" class="main__btn" style="width: 100%;"/>
                    </div>
                    <div class="main__order-details-item main__order-details-whither">
                        <input type="text" id="destination-address" name="destination" placeholder="–ö—É–¥–∞ (–∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)" class="main__btn" style="width: 100%;"/>
                    </div>
                </div>
                <div class="main__order-notes">
                    <div class="main__order-notes-text">
                        <textarea id="notes" name="notes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ"></textarea>
                    </div>
                    <div class="main__order-notes-settings">
                        <button type="button" class="main__btn-short">–ó–∞–∫–∞–∑ –¥—Ä—É–≥–æ–º—É —á–µ–ª–æ–≤–µ–∫—É</button>
                        <button type="button" class="main__btn-short">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏</button>
                    </div>
                </div>
                <div class="main__table">
                    <table>
                        <thead>
                            <tr>
                                <th>–ó–∞–∫–∞–∑</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–û—Ç–∫—É–¥–∞</th>
                                <th>–ö—É–¥–∞</th>
                                <th>–°—É–º–º–∞</th>
                            </tr>
                        </thead>
                        <tbody id="recent-orders">
                            {% if orders %}
                            {% for order in orders %}
                            <tr>
                                <td>{{ order.id }}</td>
                                <td>{{ order.time }} {{ order.created_at.strftime('%d.%m.%y') }}</td>
                                <td>{{ order.origin }}</td>
                                <td>{{ order.destination }}</td>
                                <td>{{ order.price|default('') }}</td>
                            </tr>
                            {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–∫–∞–∑–∞—Ö</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="main__order-map">
                <div class="main__order-map-item" id="map-container">
                    <!-- 2–ì–ò–° –∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—é–¥–∞ -->
                </div>
                <div class="main__order-map-settings">
                    <div class="main__order-map-settings">
                        <button type="button" class="main__btn">–î–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞—Å—Å—á–µ—Ç–∞</button>
                        <button type="button" id="clear-markers-btn" class="main__btn-short" style="background-color: #dc3545; margin-left: 10px;">–û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã</button>
                    </div>
                    <div class="route-info">
                        <div class="route-info-item">
                            <input type="text" id="tariff-display" readonly class="main__btn-short" value="–≠–∫–æ–Ω–æ–º">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="boarding-fee" readonly class="main__btn-short" value="–ü–æ—Å–∞–¥–∫–∞: 48 —Å–æ–º">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="distance" readonly class="main__btn-short" value="–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 0 –∫–º">
                        </div>
                        <div class="route-info-item">
                            <input type="text" id="price" readonly class="main__btn-short" value="–°—Ç–æ–∏–º–æ—Å—Ç—å: 0 —Å–æ–º">
                            <input type="hidden" id="calculated-price" name="price" value="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="main__order-wrapper-btn">
            <button type="submit" class="main__btn-green">–ó–∞–∫–∞–∑–∞—Ç—å</button>
            <button type="button" id="cancel-btn" class="main__btn">–û—Ç–º–µ–Ω–∏—Ç—å</button>
        </div>
    </form>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ 2–ì–ò–° MapGL JS API -->
<script src="https://mapgl.2gis.com/api/js/v1"></script>
<script>
    // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM –∏ jQuery
    document.addEventListener('DOMContentLoaded', function() {
        // –ñ–¥—ë–º —Ç–∞–∫–∂–µ –∑–∞–≥—Ä—É–∑–∫–∏ jQuery
        function waitForJQuery() {
            if (typeof $ !== 'undefined') {
                initApp();
            } else {
                setTimeout(waitForJQuery, 100);
            }
        }
        waitForJQuery();
    });

    function initApp() {
        console.log('jQuery –≥–æ—Ç–æ–≤');
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤
        const TARIFFS = {
            '–≠–∫–æ–Ω–æ–º': {
                boardingFee: 48,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 5,
                cityPricePerKm: 8.5,
                cityPricePerMinute: 3.9,
                outsideCityPricePerKm: 23,
                outsideCityPricePerMinute: 3.9
            },
            '–ö–æ–º—Ñ–æ—Ä—Ç': {
                boardingFee: 60,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 6,
                cityPricePerKm: 10.5,
                cityPricePerMinute: 4.9,
                outsideCityPricePerKm: 25,
                outsideCityPricePerMinute: 4.9
            },
            '–ö–æ–º—Ñ–æ—Ä—Ç+': {
                boardingFee: 75,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 6.5,
                cityPricePerKm: 13,
                cityPricePerMinute: 6.2,
                outsideCityPricePerKm: 28,
                outsideCityPricePerMinute: 6.2
            },
            '–ë–∏–∑–Ω–µ—Å': {
                minimumPrice: 80,
                boardingFee: 80,
                waitingFreeMinutes: 3,
                waitingPricePerMinute: 7,
                cityPricePerKm: 14,
                cityPricePerMinute: 6.5,
                outsideCityPricePerKm: 30,
                outsideCityPricePerMinute: 6.5
            }
        };
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–ö–∏—Ä–≥–∏–∑—Å–∫–æ–µ –≤—Ä–µ–º—è, GMT+6)
        function updateKyrgyzTime() {
            try {
                const now = new Date();
                // –ü–æ–ª—É—á–∞–µ–º UTC –≤—Ä–µ–º—è –∏ –¥–æ–±–∞–≤–ª—è–µ–º 6 —á–∞—Å–æ–≤ –¥–ª—è –ö–∏—Ä–≥–∏–∑–∏–∏ (GMT+6)
                const kyrgyzTime = new Date(now.getTime() + (6 * 60 * 60 * 1000));
                
                const orderTimeElement = document.getElementById('order-time');
                if (orderTimeElement) {
                    orderTimeElement.value = kyrgyzTime.toLocaleTimeString('ru-RU', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: false,
                        timeZone: 'Asia/Bishkek'
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏:', error);
            }
        }
        
        updateKyrgyzTime();
        setInterval(updateKyrgyzTime, 1000);

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –ö–∏—Ä–≥–∏–∑–∏–∏ (—Å –Ω–æ–º–µ—Ä–∞–º–∏ –¥–æ–º–æ–≤)
        const kyrgyzstanAddresses = [
            // –ì–æ—Ä–æ–¥ –û—à - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 5', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 12', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 18', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 25',
            '—É–ª. –ö—É—Ä–º–∞–Ω–∂–∞–Ω –î–∞—Ç–∫–∞, 2', '—É–ª. –ö—É—Ä–º–∞–Ω–∂–∞–Ω –î–∞—Ç–∫–∞, 8', '—É–ª. –ö—É—Ä–º–∞–Ω–∂–∞–Ω –î–∞—Ç–∫–∞, 15', '—É–ª. –ö—É—Ä–º–∞–Ω–∂–∞–Ω –î–∞—Ç–∫–∞, 22',
            '—É–ª. –ù–∞–≤–æ–∏, 3', '—É–ª. –ù–∞–≤–æ–∏, 7', '—É–ª. –ù–∞–≤–æ–∏, 14', '—É–ª. –ù–∞–≤–æ–∏, 20', '—É–ª. –ù–∞–≤–æ–∏, 28',
            '—É–ª. –ö—É–≤–∞–Ω–¥—ã–∫, 4', '—É–ª. –ö—É–≤–∞–Ω–¥—ã–∫, 9', '—É–ª. –ö—É–≤–∞–Ω–¥—ã–∫, 16', '—É–ª. –ö—É–≤–∞–Ω–¥—ã–∫, 24',
            '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 6', '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 11', '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 17', '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 23',
            '—É–ª. –ú—ã—Ä–∑–∞–ª—ã –ê–º–∞—Ç–æ–≤–∞, 2', '—É–ª. –ú—ã—Ä–∑–∞–ª—ã –ê–º–∞—Ç–æ–≤–∞, 10', '—É–ª. –ú—ã—Ä–∑–∞–ª—ã –ê–º–∞—Ç–æ–≤–∞, 19',
            '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 5', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 13', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 21', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 30',
            '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 1', '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 8', '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 15',
            '—É–ª. –ú–∞–¥–∞–Ω–∏—è, 3', '—É–ª. –ú–∞–¥–∞–Ω–∏—è, 12', '—É–ª. –ú–∞–¥–∞–Ω–∏—è, 26',
            '—É–ª. –ö–∞—Ä–∞—Å—É, 2', '—É–ª. –ö–∞—Ä–∞—Å—É, 7', '—É–ª. –ö–∞—Ä–∞—Å—É, 14', '—É–ª. –ö–∞—Ä–∞—Å—É, 21',
            '—É–ª. –°–∞–ª–∏–µ–≤–∞, 4', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 11', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 18',
            '—É–ª. –û–º—É—Ä–∑–∞–∫–æ–≤–∞, 6', '—É–ª. –û–º—É—Ä–∑–∞–∫–æ–≤–∞, 13', '—É–ª. –û–º—É—Ä–∑–∞–∫–æ–≤–∞, 20',
            '—É–ª. –ê–π—Ç–º–∞—Ç–æ–≤–∞, 1', '—É–ª. –ê–π—Ç–º–∞—Ç–æ–≤–∞, 9', '—É–ª. –ê–π—Ç–º–∞—Ç–æ–≤–∞, 16',
            '–ø—Ä. –ñ–∞–π–ª–∞—É, 5', '–ø—Ä. –ñ–∞–π–ª–∞—É, 12', '–ø—Ä. –ñ–∞–π–ª–∞—É, 19',
            '–ø—Ä. –ú–∞—Å–∞–ª–∏–µ–≤–∞, 3', '–ø—Ä. –ú–∞—Å–∞–ª–∏–µ–≤–∞, 10', '–ø—Ä. –ú–∞—Å–∞–ª–∏–µ–≤–∞, 17',
            '–º–∫—Ä. –ê—ç—Ä–æ–ø–æ—Ä—Ç, 1', '–º–∫—Ä. –ê—ç—Ä–æ–ø–æ—Ä—Ç, 2', '–º–∫—Ä. –ê—ç—Ä–æ–ø–æ—Ä—Ç, 3',
            '–º–∫—Ä. –¶–µ–Ω—Ç—Ä, 1', '–º–∫—Ä. –¶–µ–Ω—Ç—Ä, 2', '–º–∫—Ä. –¶–µ–Ω—Ç—Ä, 4',
            
            // –ë–∏—à–∫–µ–∫ - –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–¥—Ä–µ—Å–∞
            '—É–ª. –ö–∏–µ–≤—Å–∫–∞—è, 1', '—É–ª. –ö–∏–µ–≤—Å–∫–∞—è, 15', '—É–ª. –ö–∏–µ–≤—Å–∫–∞—è, 25', '—É–ª. –ö–∏–µ–≤—Å–∫–∞—è, 42',
            '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 3', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 18', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 33', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 48',
            '—É–ª. –ú–∞–Ω–∞—Å, 5', '—É–ª. –ú–∞–Ω–∞—Å, 12', '—É–ª. –ú–∞–Ω–∞—Å, 28', '—É–ª. –ú–∞–Ω–∞—Å, 35',
            '—É–ª. –ß—É–π, 2', '—É–ª. –ß—É–π, 19', '—É–ª. –ß—É–π, 36', '—É–ª. –ß—É–π, 51',
            '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 4', '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 21', '—É–ª. –ò—Å–∞–Ω–æ–≤–∞, 38',
            '—É–ª. –ë–æ–∫–æ–Ω–±–∞–µ–≤–∞, 7', '—É–ª. –ë–æ–∫–æ–Ω–±–∞–µ–≤–∞, 16', '—É–ª. –ë–æ–∫–æ–Ω–±–∞–µ–≤–∞, 29',
            '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 1', '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 13', '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 24',
            '—É–ª. –¢—É—Ä—É—Å–±–µ–∫–æ–≤–∞, 6', '—É–ª. –¢—É—Ä—É—Å–±–µ–∫–æ–≤–∞, 17', '—É–ª. –¢—É—Ä—É—Å–±–µ–∫–æ–≤–∞, 32',
            '—É–ª. –ñ–∏–±–µ–∫ –ñ–æ–ª—É, 2', '—É–ª. –ñ–∏–±–µ–∫ –ñ–æ–ª—É, 14', '—É–ª. –ñ–∏–±–µ–∫ –ñ–æ–ª—É, 27',
            '–ø—Ä. –ú–∏—Ä–∞, 5', '–ø—Ä. –ú–∏—Ä–∞, 18', '–ø—Ä. –ú–∏—Ä–∞, 31', '–ø—Ä. –ú–∏—Ä–∞, 44',
            '–ø—Ä. –ß—É–π, 3', '–ø—Ä. –ß—É–π, 22', '–ø—Ä. –ß—É–π, 41', '–ø—Ä. –ß—É–π, 56',
            '–ø—Ä. –î–µ–Ω –°—è–æ–ø–∏–Ω–∞, 1', '–ø—Ä. –î–µ–Ω –°—è–æ–ø–∏–Ω–∞, 8', '–ø—Ä. –î–µ–Ω –°—è–æ–ø–∏–Ω–∞, 15',
            '–º–∫—Ä. –î–∂–∞–ª, 1', '–º–∫—Ä. –î–∂–∞–ª, 3', '–º–∫—Ä. –î–∂–∞–ª, 6',
            '–º–∫—Ä. –ê—Å–∞–Ω–±–∞–π, 2', '–º–∫—Ä. –ê—Å–∞–Ω–±–∞–π, 4', '–º–∫—Ä. –ê—Å–∞–Ω–±–∞–π, 7',
            
            // –î–∂–∞–ª–∞–ª-–ê–±–∞–¥
            '—É–ª. –≠—Ä–∫–∏–Ω–¥–∏–∫, 1', '—É–ª. –≠—Ä–∫–∏–Ω–¥–∏–∫, 12', '—É–ª. –≠—Ä–∫–∏–Ω–¥–∏–∫, 23',
            '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 5', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 16', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 27',
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 3', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 14', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 25',
            '—É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, 2', '—É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, 9', '—É–ª. –°–æ–≤–µ—Ç—Å–∫–∞—è, 18',
            
            // –ö–∞—Ä–∞–∫–æ–ª
            '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 1', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 8', '—É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞, 15',
            '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 4', '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 11', '—É–ª. –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞, 19',
            '—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 2', '—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 7', '—É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, 14',
            '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 6', '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 13', '—É–ª. –ú–æ—Å–∫–æ–≤—Å–∫–∞—è, 20',
            
            // –ù–∞—Ä—ã–Ω
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 9', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 16',
            '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 3', '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 12', '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 21',
            '—É–ª. –°–∞–ª–∏–µ–≤–∞, 5', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 14', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 23',
            
            // –¢–∞–ª–∞—Å
            '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 2', '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 10', '—É–ª. –ë–µ—Ä–¥–∏–∫–µ –ë–∞–∞—Ç—ã—Ä–∞, 18',
            '—É–ª. –§—Ä—É–Ω–∑–µ, 4', '—É–ª. –§—Ä—É–Ω–∑–µ, 13', '—É–ª. –§—Ä—É–Ω–∑–µ, 22',
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 8', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 17',
            
            // –ë–∞—Ç–∫–µ–Ω
            '—É–ª. –õ–µ–Ω–∏–Ω–∞, 1', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 6', '—É–ª. –õ–µ–Ω–∏–Ω–∞, 12',
            '—É–ª. –°–∞–ª–∏–µ–≤–∞, 3', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 9', '—É–ª. –°–∞–ª–∏–µ–≤–∞, 15',
            
            // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞ –∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã
            '–û—à—Å–∫–∏–π —Ä—ã–Ω–æ–∫', '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –º–µ—á–µ—Ç—å, –û—à', '–ê—ç—Ä–æ–ø–æ—Ä—Ç –û—à',
            '–¢–¶ –û—à-–ü–ª–∞–∑–∞', '–ü–∞—Ä–∫ –ù–∞–≤–æ–∏, –û—à', '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª, –û—à',
            '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä, –û—à', '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, –û—à', '–°—Ç–∞–¥–∏–æ–Ω, –û—à',
            '–ê–ª–∞-–¢–æ–æ –ø–ª–æ—â–∞–¥—å, –ë–∏—à–∫–µ–∫', '–¢–¶ –í–µ—Ñ–∞, –ë–∏—à–∫–µ–∫', '–û—à—Å–∫–∏–π —Ä—ã–Ω–æ–∫, –ë–∏—à–∫–µ–∫',
            '–ê—ç—Ä–æ–ø–æ—Ä—Ç –ú–∞–Ω–∞—Å, –ë–∏—à–∫–µ–∫', '–ü–∞—Ä–∫ –ê—Ç–∞—Ç—é—Ä–∫, –ë–∏—à–∫–µ–∫', '–ñ–î –≤–æ–∫–∑–∞–ª, –ë–∏—à–∫–µ–∫'
        ];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç—ã 2–ì–ò–° MapGL
        let map;
        let originMarker;
        let destinationMarker;
        let routeLayer;
        let distance = 0;
        let duration = 0;
        let originCoords = null;
        let destinationCoords = null;
        let clickCounter = 0; // –°—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤: 0/2 = —Ç–æ—á–∫–∞ –ê, 1 = —Ç–æ—á–∫–∞ –ë

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã 2–ì–ò–° MapGL
        function initMap() {
            try {
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã 2–ì–ò–° MapGL...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ MapGL –¥–æ—Å—Ç—É–ø–µ–Ω
                if (typeof mapgl === 'undefined') {
                    console.error('MapGL API –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }
                
                // –¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞ –û—à, –ö–∏—Ä–≥–∏–∑–∏—è
                const oshCenter = [72.8019, 40.5138]; // [lng, lat] –¥–ª—è MapGL - –≥–æ—Ä–æ–¥ –û—à
                
                map = new mapgl.Map('map-container', {
                    center: oshCenter,
                    zoom: 12, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑—É–º –¥–ª—è –≥–æ—Ä–æ–¥–∞
                    key: '3025505a-cdb6-4ddc-819b-1c546552efe3',
                    minZoom: 5,
                    maxZoom: 18
                });
                
                console.log('–ö–∞—Ä—Ç–∞ 2–ì–ò–° MapGL —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –≥–æ—Ä–æ–¥–∞ –û—à');

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –õ–ï–í–û–ô –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–æ—á–µ–∫
                map.on('click', function(e) {
                    const coords = e.lngLat;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ö–∏—Ä–≥–∏–∑–∏–∏
                    if (isWithinKyrgyzstan(coords.lat, coords.lng)) {
                        console.log('‚úÖ –ö–ª–∏–∫ –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º –≤ –ö–∏—Ä–≥–∏–∑–∏–∏:', coords.lat, coords.lng);
                        
                        // –ü–æ–æ—á–µ—Ä–µ–¥–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–∫–∏ –ê –∏ –ë
                        if (clickCounter % 2 === 0) {
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–∫—É –ê (–æ—Ç–∫—É–¥–∞)
                            setMarkerByClick(coords, 'origin');
                            console.log('üÖ∞Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ—á–∫–∞ –ê (–æ—Ç–∫—É–¥–∞)');
                        } else {
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ—á–∫—É –ë (–∫—É–¥–∞)
                            setMarkerByClick(coords, 'destination');
                            console.log('üÖ±Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ—á–∫–∞ –ë (–∫—É–¥–∞)');
                        }
                        
                        clickCounter++;
                    } else {
                        console.warn('‚ö†Ô∏è –¢–æ—á–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ö–∏—Ä–≥–∏–∑–∏–∏:', coords.lat, coords.lng);
                        // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º - –≤—Å–µ —Ä–∞–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä
                        if (clickCounter % 2 === 0) {
                            setMarkerByClick(coords, 'origin');
                            console.log('üÖ∞Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ—á–∫–∞ –ê (–≤–Ω–µ –ö–∏—Ä–≥–∏–∑–∏–∏)');
                        } else {
                            setMarkerByClick(coords, 'destination');
                            console.log('üÖ±Ô∏è –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ç–æ—á–∫–∞ –ë (–≤–Ω–µ –ö–∏—Ä–≥–∏–∑–∏–∏)');
                        }
                        clickCounter++;
                    }
                });
                
                console.log('–ö–∞—Ä—Ç–∞ 2–ì–ò–° MapGL —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –≥–æ—Ä–æ–¥–∞ –û—à');
                console.log('üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:');
                console.log('   ‚Ä¢ –ö–ª–∏–∫–∞–π—Ç–µ –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π: 1-–π –∫–ª–∏–∫ = —Ç–æ—á–∫–∞ –ê, 2-–π –∫–ª–∏–∫ = —Ç–æ—á–∫–∞ –ë');
                console.log('   ‚Ä¢ –ò–ª–∏ –≤–≤–æ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å–∞ –≤ –ø–æ–ª—è - –º–∞—Ä–∫–µ—Ä—ã —Å—Ç–∞–≤—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
                console.log('   ‚Ä¢ –í—ã–±–∏—Ä–∞–π—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã 2–ì–ò–° MapGL:', error);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ö–∏—Ä–≥–∏–∑–∏–∏ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã)
        function isWithinKyrgyzstan(lat, lng) {
            // –†–∞—Å—à–∏—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –ö–∏—Ä–≥–∏–∑–∏–∏
            return (lat >= 39.0 && lat <= 43.5 && lng >= 69.0 && lng <= 80.5);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É)
        function geocodeAddress(address, callback) {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            const addressCoords = {
                // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≥–æ—Ä–æ–¥–æ–≤ –∏ —É–ª–∏—Ü
                '–æ—à': [72.8019, 40.5138],
                '–±–∏—à–∫–µ–∫': [74.5975, 42.8746],
                '–¥–∂–∞–ª–∞–ª-–∞–±–∞–¥': [72.9358, 40.9333],
                '–∫–∞—Ä–∞–∫–æ–ª': [78.3933, 42.4906],
                '–Ω–∞—Ä—ã–Ω': [76.0000, 41.4286],
                '—Ç–∞–ª–∞—Å': [72.2424, 42.5228],
                '–±–∞—Ç–∫–µ–Ω': [70.8167, 40.0642],
                
                // –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É–ª–∏—Ü—ã –≤ –û—à–µ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—Ä–∏–º–µ—Ä–Ω—ã–µ)
                '—É–ª. –ª–µ–Ω–∏–Ω–∞': [72.8019, 40.5138],
                '—É–ª. –∫—É—Ä–º–∞–Ω–∂–∞–Ω –¥–∞—Ç–∫–∞': [72.8050, 40.5150],
                '—É–ª. –Ω–∞–≤–æ–∏': [72.8100, 40.5120],
                '—É–ª. –∫–∞—Ä–∞—Å—É': [72.7950, 40.5160],
                '—É–ª. —Ç–æ–∫—Ç–æ–≥—É–ª–∞': [72.8080, 40.5140],
                '—É–ª. –∏—Å–∞–Ω–æ–≤–∞': [72.8030, 40.5130],
                
                // –£–ª–∏—Ü—ã –≤ –ë–∏—à–∫–µ–∫–µ
                '—É–ª. —á—É–π': [74.5975, 42.8746],
                '—É–ª. –∫–∏–µ–≤—Å–∫–∞—è': [74.6000, 42.8760],
                '—É–ª. –º–æ—Å–∫–æ–≤—Å–∫–∞—è': [74.6020, 42.8740],
                '–ø—Ä. –º–∏—Ä–∞': [74.5950, 42.8750],
                
                // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Å—Ç–∞
                '–æ—à—Å–∫–∏–π —Ä—ã–Ω–æ–∫': [72.8000, 40.5145],
                '–∞—ç—Ä–æ–ø–æ—Ä—Ç –æ—à': [72.7929, 40.6090],
                '–∞—ç—Ä–æ–ø–æ—Ä—Ç –º–∞–Ω–∞—Å': [74.4776, 43.0612],
                '–∞–ª–∞-—Ç–æ–æ –ø–ª–æ—â–∞–¥—å': [74.5900, 42.8760]
            };
            
            const normalizedAddress = address.toLowerCase();
            
            // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            for (const [key, coords] of Object.entries(addressCoords)) {
                if (normalizedAddress.includes(key)) {
                    callback(coords[0], coords[1]); // lng, lat
                    return;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –û—à–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            callback(72.8019, 40.5138);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ (—É–ª—É—á—à–µ–Ω–Ω–∞—è)
        function setMarkerByClick(coords, type) {
            console.log('–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–∞—Ä–∫–µ—Ä–∞', type, '–ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º:', coords.lat, coords.lng);
            
            // –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            const address = `${coords.lat.toFixed(6)}, ${coords.lng.toFixed(6)}`;
                    
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä
            if (type === 'origin') {
                if (originMarker) {
                    originMarker.destroy();
                }
                
                originCoords = [coords.lng, coords.lat]; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                originMarker = new mapgl.Marker(map, {
                    coordinates: originCoords,
                    icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                });
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞
                $('#origin-address').val(address);
                console.log('‚úÖ –¢–æ—á–∫–∞ –ê —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', address);
                        
            } else if (type === 'destination') {
                if (destinationMarker) {
                    destinationMarker.destroy();
                }
                
                destinationCoords = [coords.lng, coords.lat]; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                destinationMarker = new mapgl.Marker(map, {
                    coordinates: destinationCoords,
                    icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                });
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –∞–¥—Ä–µ—Å–∞
                $('#destination-address').val(address);
                console.log('‚úÖ –¢–æ—á–∫–∞ –ë —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', address);
            }
                    
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç, –µ—Å–ª–∏ –æ–±–∞ –∞–¥—Ä–µ—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
            if ($('#origin-address').val() && $('#destination-address').val()) {
                console.log('üó∫Ô∏è –û–±–∞ –∞–¥—Ä–µ—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç...');
                calculateRoute();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–∞ –ø–æ –∞–¥—Ä–µ—Å—É (–Ω–æ–≤–∞—è)
        function setMarkerByAddress(address, type) {
            if (!address || address.length < 2) return;
            
            console.log('–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞:', address, '–¥–ª—è —Ç–∏–ø–∞:', type);
            
            geocodeAddress(address, function(lng, lat) {
                const coords = { lng: lng, lat: lat };
                
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –∞–¥—Ä–µ—Å–∞', address, ':', lng, lat);
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä
                    if (type === 'origin') {
                        if (originMarker) {
                        originMarker.destroy();
                    }
                    
                    originCoords = [lng, lat];
                    originMarker = new mapgl.Marker(map, {
                        coordinates: originCoords,
                        icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                    });
                    
                    console.log('‚úÖ –ú–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ê —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É');
                        
                    } else if (type === 'destination') {
                        if (destinationMarker) {
                        destinationMarker.destroy();
                    }
                    
                    destinationCoords = [lng, lat];
                    destinationMarker = new mapgl.Marker(map, {
                        coordinates: destinationCoords,
                        icon: 'https://docs.2gis.com/img/nav-gp-pin.svg'
                    });
                    
                    console.log('‚úÖ –ú–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ë —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É');
                }
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –Ω–æ–≤–æ–º –º–∞—Ä–∫–µ—Ä–µ
                map.setCenter([lng, lat]);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä—à—Ä—É—Ç, –µ—Å–ª–∏ –æ–±–∞ –∞–¥—Ä–µ—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
                if (originCoords && destinationCoords) {
                    console.log('üó∫Ô∏è –û–±–∞ –º–∞—Ä–∫–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞—Ä—à—Ä—É—Ç...');
                        calculateRoute();
                }
            });
        }

        // –†–∞—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞
        function calculateRoute() {
            try {
                console.log('–†–∞—Å—á–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ 2–ì–ò–° MapGL');
                const origin = $('#origin-address').val();
                const destination = $('#destination-address').val();
            
            if (!origin || !destination) {
                console.log('–ù–µ –∑–∞–¥–∞–Ω—ã –Ω–∞—á–∞–ª—å–Ω–∞—è –∏–ª–∏ –∫–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞');
                return;
            }
            
                // –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
                if (originCoords && destinationCoords) {
                    // –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–æ –ø—Ä—è–º–æ–π (–≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö)
                    distance = calculateDistance(originCoords[1], originCoords[0], destinationCoords[1], destinationCoords[0]);
                    // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö (—Å—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å 30 –∫–º/—á –≤ –≥–æ—Ä–æ–¥–µ)
                    duration = (distance / 30) * 60;
                    
                    console.log('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ:', distance.toFixed(1), '–∫–º, –≤—Ä–µ–º—è:', duration.toFixed(0), '–º–∏–Ω');
                    
                    $('#distance').val(`–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${distance.toFixed(1)} –∫–º`);
                    
                    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
                    calculatePrice();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏–Ω–∏—é –º–∞—Ä—à—Ä—É—Ç–∞
                    if (routeLayer) {
                        routeLayer.destroy();
                    }
                    
                    routeLayer = new mapgl.Polyline(map, {
                        coordinates: [originCoords, destinationCoords],
                        color: '#00FFFC',
                        width: 5
                    });
                    
                    // –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É –ø–æ–¥ –º–∞—Ä—à—Ä—É—Ç
                    const bounds = [
                        [Math.min(originCoords[0], destinationCoords[0]), Math.min(originCoords[1], destinationCoords[1])],
                        [Math.max(originCoords[0], destinationCoords[0]), Math.max(originCoords[1], destinationCoords[1])]
                    ];
                    map.fitBounds(bounds, { padding: 50 });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–º
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–µ–∑–¥–∫–∏
        function calculatePrice() {
            try {
                const tariff = $('#tariff-select').val();
                console.log('–†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞:', tariff);
                
                if (!tariff || !TARIFFS[tariff]) {
                    console.error('–¢–∞—Ä–∏—Ñ –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤:', tariff);
                    return;
                }

                const tariffData = TARIFFS[tariff];
                let price = tariffData.boardingFee;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞
                $('#tariff-display').val(tariff);
                
                // –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
                if (distance > 0) {
                    const pricePerKm = tariffData.cityPricePerKm;
                    const pricePerMinute = tariffData.cityPricePerMinute;
                    
                    const distancePrice = distance * pricePerKm;
                    const timePrice = duration * pricePerMinute;
                    
                    price += distancePrice + timePrice;
                }
                
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞
                if (tariff === '–ë–∏–∑–Ω–µ—Å' && price < tariffData.minimumPrice) {
                    price = tariffData.minimumPrice;
                }
                
                // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
                price = Math.ceil(price);
                
                $('#price').val(`–°—Ç–æ–∏–º–æ—Å—Ç—å: ${price} —Å–æ–º`);
                $('#calculated-price').val(price);
                $('#boarding-fee').val(`–ü–æ—Å–∞–¥–∫–∞: ${tariffData.boardingFee} —Å–æ–º`);
                
                console.log('–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏:', {
                    —Ç–∞—Ä–∏—Ñ: tariff,
                    —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: distance.toFixed(1) + ' –∫–º',
                    –≤—Ä–µ–º—è: duration.toFixed(0) + ' –º–∏–Ω',
                    —Ü–µ–Ω–∞: price + ' —Å–æ–º'
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        $(window).on('load', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...');
            setTimeout(function() {
                try {
                    initMap();
                    console.log('–ö–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:', error);
                }
            }, 500);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        $('#driver-select').change(function() {
            const selectedOption = $(this).find('option:selected');
            const phone = selectedOption.data('phone');
            const tariff = selectedOption.data('tariff');
            
            $('#driver-phone').val(phone);
            
            if (tariff) {
                $('#tariff-select').val(tariff);
                $('#tariff-select').trigger('change');
            }
        });

        $('#tariff-select').change(function() {
            try {
                const tariff = $(this).val();
                console.log('–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ –Ω–∞:', tariff);
                
                if (tariff) {
                    $('#tariff-display').val(tariff);
                    calculatePrice();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–∞:', error);
            }
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π
        $('#origin-address, #destination-address').on('change keyup', function() {
            const fieldId = $(this).attr('id');
            const address = $(this).val().trim();
            console.log('–ò–∑–º–µ–Ω–µ–Ω –∞–¥—Ä–µ—Å –≤ –ø–æ–ª–µ:', fieldId, '‚Üí', address);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ –ø–æ –≤–≤–µ–¥–µ–Ω–Ω–æ–º—É –∞–¥—Ä–µ—Å—É
            if (address.length > 2) {
                const type = fieldId.includes('origin') ? 'origin' : 'destination';
                console.log('üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –¥–ª—è:', type);
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏—Ç—å –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ
                clearTimeout(window.addressTimeout);
                window.addressTimeout = setTimeout(function() {
                    setMarkerByAddress(address, type);
                }, 800); // 800–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–ª–µ–π –∞–¥—Ä–µ—Å–æ–≤
        function initAutocomplete() {
            $('#origin-address, #destination-address').each(function() {
                const $input = $(this);
                const $container = $input.parent();
                
                // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if (!$container.find('.autocomplete-dropdown').length) {
                    $container.css('position', 'relative');
                    $container.append('<div class="autocomplete-dropdown"></div>');
                }
                
                const $dropdown = $container.find('.autocomplete-dropdown');
                
                $input.on('input', function() {
                    const value = $(this).val().toLowerCase().trim();
                    $dropdown.empty().hide();
                    
                    if (value.length >= 2) {
                        const matches = kyrgyzstanAddresses.filter(address => 
                            address.toLowerCase().includes(value)
                        ).slice(0, 15); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 15 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                        
                        if (matches.length > 0) {
                            matches.forEach(address => {
                                const $item = $('<div class="autocomplete-item">' + address + '</div>');
                                $item.on('click', function() {
                                    $input.val(address);
                                    $dropdown.hide();
                                    console.log('‚úÖ –í—ã–±—Ä–∞–Ω –∞–¥—Ä–µ—Å –∏–∑ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è:', address);
                                    
                                    // –°—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∏–∑ —Å–ø–∏—Å–∫–∞
                                    const type = $input.attr('id').includes('origin') ? 'origin' : 'destination';
                                    console.log('üéØ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞:', type);
                                    setMarkerByAddress(address, type);
                                });
                                $dropdown.append($item);
                            });
                            $dropdown.show();
                        }
                    }
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                $(document).on('click', function(e) {
                    if (!$container.is(e.target) && !$container.has(e.target).length) {
                        $dropdown.hide();
                    }
                });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(initAutocomplete, 500);
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è –ö–∏—Ä–≥–∏–∑–∏–∏ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ (–¥–µ–ª–∞–µ–º –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–æ–π)
        $('#origin-address, #destination-address').on('blur', function() {
            const address = $(this).val().toLowerCase().trim();
            // –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω–æ —á—Ç–æ-—Ç–æ
            if (address && address.length > 2) {
                if (!isKyrgyzstanAddress(address)) {
                    // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º alert, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    console.warn('–í–≤–µ–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –ö–∏—Ä–≥–∏–∑–∏–∏:', address);
                }
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ –∞–¥—Ä–µ—Å –∫ –ö–∏—Ä–≥–∏–∑–∏–∏ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function isKyrgyzstanAddress(address) {
            const kyrgyzstanKeywords = [
                '–∫—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω', '–∫–∏—Ä–≥–∏–∑–∏—è', '–±–∏—à–∫–µ–∫', '–æ—à', '–¥–∂–∞–ª–∞–ª-–∞–±–∞–¥', '–¥–∂–∞–ª–∞–ª–∞–±–∞–¥',
                '–∫–∞—Ä–∞–∫–æ–ª', '–Ω–∞—Ä—ã–Ω', '—Ç–∞–ª–∞—Å', '–±–∞—Ç–∫–µ–Ω', '—á—É–π', '–∏—Å—Å—ã–∫-–∫—É–ª—å', '–∏—Å—ã–∫–∫—É–ª—å',
                '–∫–≥', 'kg', 'bishkek', 'osh', 'jalal-abad', 'karakol', 
                'naryn', 'talas', 'batken', '—á–æ–ª–ø–æ–Ω-–∞—Ç–∞', '–∫–µ—Ä–±–µ–Ω', '—Ç–æ–∫–º–∞–∫',
                '–∫–∞–Ω—Ç', '—Å–æ–∫—É–ª—É–∫', '–±–µ–ª–æ–≤–æ–¥—Å–∫–æ–µ', '–∫–µ–º–∏–Ω', '—á–æ–ª–ø–æ–Ω', '–∞—Ç–∞',
                '–∫–æ—á–∫–æ—Ä', '–∞—Ç-–±–∞—à—ã', '–∫—ã–∑—ã–ª-–∫–∏—è', '—Å—É–ª—é–∫—Ç–∞', '—É–∑–≥–µ–Ω',
                '–∞—Ä—Å–ª–∞–Ω–±–æ–±', '–º–∞–π–ª—É—É-—Å—É—É', '–∂–∞–ª–∞–ª-–∞–±–∞–¥', '–∫–∞–π—ã–Ω–¥—ã', '–±–∞–∑–∞—Ä-–∫–æ—Ä–≥–æ–Ω',
                '–Ω–æ–æ–∫–∞—Ç', '–∫–∞—Ä–∞-—Å—É—É', '–∫–∞—Ä–∞-–∫—É–ª–∂–∞', '–ª–µ–Ω–∏–Ω', '–ø–∏–∫', '–ª–µ–Ω–∏–Ω–∞'
            ];
            
            // –ï—Å–ª–∏ –∞–¥—Ä–µ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ - —Å—á–∏—Ç–∞–µ–º –≤–∞–ª–∏–¥–Ω—ã–º
            // –ò–ª–∏ –µ—Å–ª–∏ –∞–¥—Ä–µ—Å –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–∞/–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã - —Ç–æ–∂–µ –≤–∞–ª–∏–¥–Ω—ã–º
            return kyrgyzstanKeywords.some(keyword => address.includes(keyword)) || 
                   /^[\d\.,\s\-]+$/.test(address); // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–ª–∏ —á–∏—Å–ª–∞
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        $('#order-form').submit(function(e) {
            e.preventDefault();
            
            const driverId = $('#driver-select').val();
            const tariff = $('#tariff-select').val();
            const paymentMethod = $('#payment-method').val();
            const origin = $('#origin-address').val();
            const destination = $('#destination-address').val();
            
            if (!driverId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥–∏—Ç–µ–ª—è');
                return false;
            }
            if (!tariff) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ');
                return false;
            }
            if (!paymentMethod) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã');
                return false;
            }
            if (!origin) {
                alert('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
                return false;
            }
            if (!destination) {
                alert('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è');
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞–¥—Ä–µ—Å–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ö–∏—Ä–≥–∏–∑–∏–∏ (–¥–µ–ª–∞–µ–º –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–º)
            if (!isKyrgyzstanAddress(origin.toLowerCase())) {
                console.warn('–í–Ω–∏–º–∞–Ω–∏–µ: –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –ö–∏—Ä–≥–∏–∑–∏–∏');
                // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É, —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
            }
            if (!isKyrgyzstanAddress(destination.toLowerCase())) {
                console.warn('–í–Ω–∏–º–∞–Ω–∏–µ: –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–µ—Ç –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –ö–∏—Ä–≥–∏–∑–∏–∏');
                // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É, —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
            $.ajax({
                type: 'POST',
                url: '/api/orders/',
                data: $(this).serialize(),
                success: function(response) {
                    alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    window.location.href = '/disp/';
                },
                error: function(error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: ' + (error.responseJSON ? error.responseJSON.detail : '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º'));
                }
            });
        });
        
        // –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞
        $('#cancel-btn').click(function() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞?')) {
                window.location.href = '/disp/';
            }
        });
        
        // –ù–∞–∂–∞—Ç–∏–µ –∫–ª–∞–≤–∏—à–∏ F2 –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
        $(document).keydown(function(e) {
            if (e.keyCode === 113) { // F2 key
                e.preventDefault();
                window.location.reload();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã"
        $('#clear-markers-btn').click(function() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –∏ –ø–æ–ª—è –∞–¥—Ä–µ—Å–æ–≤?')) {
                // –û—á–∏—â–∞–µ–º –º–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ê
                if (originMarker) {
                    originMarker.destroy();
                    originMarker = null;
                    console.log('üóëÔ∏è –ú–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ê —É–¥–∞–ª–µ–Ω');
                }
                originCoords = null;
                $('#origin-address').val('');
                
                // –û—á–∏—â–∞–µ–º –º–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ë
                if (destinationMarker) {
                    destinationMarker.destroy();
                    destinationMarker = null;
                    console.log('üóëÔ∏è –ú–∞—Ä–∫–µ—Ä —Ç–æ—á–∫–∏ –ë —É–¥–∞–ª–µ–Ω');
                }
                destinationCoords = null;
                $('#destination-address').val('');
                
                // –û—á–∏—â–∞–µ–º –º–∞—Ä—à—Ä—É—Ç
                if (routeLayer) {
                    routeLayer.destroy();
                    routeLayer = null;
                    console.log('üóëÔ∏è –ú–∞—Ä—à—Ä—É—Ç —É–¥–∞–ª–µ–Ω');
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞—Å—á–µ—Ç—ã
                distance = 0;
                duration = 0;
                $('#distance').val('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 0 –∫–º');
                $('#price').val('–°—Ç–æ–∏–º–æ—Å—Ç—å: 0 —Å–æ–º');
                $('#calculated-price').val(0);
                $('#boarding-fee').val('–ü–æ—Å–∞–¥–∫–∞: 48 —Å–æ–º');
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤
                clickCounter = 0;
                
                // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –û—à
                if (map) {
                    map.setCenter([72.8019, 40.5138]);
                    map.setZoom(12);
                }
                
                console.log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã, –∫–∞—Ä—Ç–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é');
            }
        });
    } // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ initApp
</script>
<style>
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    .main__order-wrapper {
        border-radius: 5px;
    }
    .main__order-header {
        flex-wrap: wrap;
    }
    .main__btn {
        padding: 12px 30px;
    }
    .main__order-subheader {
        gap: 20px;
        flex-wrap: wrap;
    }
    .main__order-subheader-item {
        width: 100%;
    } 
    .main__subheader-filing {
        width: 100%;
    }
    #tariff-select,
    #payment-method {
        width: 100%;
    }
    .main__order-subheader-item .main__btn-short {
        width: 100%;
    }
    .main__order-notes {
        width: 100%;
        display: flex;
        justify-content: space-between;
    } 
    .main__order-notes-text {
        width: 65%;
    }
    @media (max-width: 1200px) {
        .main__order-wrapper-blocks {
            flex-direction: column;
        }
        .main__order-settings, .main__order-map {
            width: 100%;
            margin-bottom: 20px;
        }
        .main__header-tags ul li {
            padding: 10px 15px;
        }
    }
    
    @media (max-width: 768px) {
        .main__header {
            flex-direction: column;
            align-items: flex-start;
        }
        .main__header-logo, .main__header-tags, .main__header-search {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__subheader-add {
            flex-wrap: wrap;
        }
        .main__order-header, .main__order-subheader {
            flex-direction: column;
        }
        .main__order-header-item, .main__order-subheader-item {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__order-details-item {
            flex-direction: column;
        }
        .main__order-details-item input {
            width: 100%;
            margin-bottom: 10px;
        }
        .main__order-map-item {
            height: 300px;
        }
    }
    
    /* –£–ª—É—á—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∏–ª–µ–π */
    .main__order-map-item {
        min-height: 400px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .main__btn, .main__btn-short, .main__btn-green {
        transition: all 0.3s ease;
    }
    
    .main__btn:hover, .main__btn-short:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .main__btn-green:hover {
        background-color: #35a63a;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .main__order-notes-text textarea {
        width: 100%;
        min-height: 80px;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #47484c;
        background-color: #2d2e33;
        color: #fff;
        resize: vertical;
    }
    
    /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∞ */
    .route-info {
        background-color: #2d2e33;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    
    .route-info-item {
        background-color: #47484c;
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        width: 100%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .route-info-item input {
        width: 90%;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤ */
    .autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background-color: #2d2e33;
        border: 1px solid #47484c;
        border-top: none;
        border-radius: 0 0 5px 5px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .autocomplete-item {
        padding: 10px 15px;
        cursor: pointer;
        color: #fff;
        border-bottom: 1px solid #47484c;
        transition: background-color 0.2s;
    }
    
    .autocomplete-item:hover {
        background-color: #47484c;
    }
    
    .autocomplete-item:last-child {
        border-bottom: none;
    }
    
    /* –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∞–¥—Ä–µ—Å–æ–≤ */
    .main__order-details-item {
        position: relative;
    }
    
    @media (max-width: 576px) {
        .route-info-item {
            width: 100%;
        }
    }
</style>
{% endblock %}