<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Wazir.kg</title>
        <link rel="stylesheet"
            href="{{ url_for('static', path='/driver/assets/scss/main.css') }}">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">
        <style>
            /* –£–±–∏—Ä–∞–µ–º border-radius —É –∫–Ω–æ–ø–æ–∫ */
            .main__btn, button {
                border-radius: 0px !important;
            }
            
            /* –°–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
            .spinner {
                display: none;
                width: 20px;
                height: 20px;
                border: 2px solid #f3f3f3;
                border-top: 2px solid #3498db;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-left: 10px;
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            .btn-with-spinner {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="brand">
                <div class="container">
                    <div class="brand__content">
                        <div class="logo">
                            <a href="{{ url_for('user_auth_step1') }}">
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/logo.png') }}"
                                    alt="logo">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <main>
            <section class="register">
                <div class="container">
                    <div class="register__content">
                        <div class="register__intro">
                            <h1 class="title">
                                –£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é
                            </h1>
                        </div>
                        <div class="register__form register__auth">
                            <form id="nameForm">
                                <input type="text" id="firstName"
                                    name="first_name" placeholder="–ò–º—è"
                                    required>
                                <input type="text" id="lastName"
                                    name="last_name" placeholder="–§–∞–º–∏–ª–∏—è"
                                    required>
                                <button type="submit"
                                    class="main__btn btn-with-spinner">
                                    <span class="btn-text">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span>
                                    <div class="spinner"></div>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏
                $('.register__auth form input').on('input', function () {
                    const $form = $('.register__auth form');
                    const $inputs = $form.find('input');
                    const $submitBtn = $form.find('.main__btn');

                    const allFilled = Array.from($inputs).every(input => input.value.trim() !== '');

                    if (allFilled) {
                        $submitBtn.addClass('main__btn-active');
                    } else {
                        $submitBtn.removeClass('main__btn-active');
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                const $form = $('.register__auth form');
                const $inputs = $form.find('input');
                const $submitBtn = $form.find('.main__btn');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                const savedFirstName = localStorage.getItem('user_first_name');
                const savedLastName = localStorage.getItem('user_last_name');
                
                if (savedFirstName) {
                    $('#firstName').val(savedFirstName);
                }
                if (savedLastName) {
                    $('#lastName').val(savedLastName);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userId = localStorage.getItem('user_id');
                if (!userId) {
                    showError('–û—à–∏–±–∫–∞: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.');
                    // –î–µ–ª–∞–µ–º —Ñ–æ—Ä–º—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
                    $inputs.prop('disabled', true);
                    $submitBtn.prop('disabled', true);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                    const $backBtn = $('<button>')
                        .attr('type', 'button')
                        .addClass('main__btn')
                        .text('–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏')
                        .css('margin-top', '15px')
                        .on('click', function() {
                            window.location.href = '/user/auth/1';
                        });
                    
                    $form.append($backBtn);
                } else {
                    console.log('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–π–¥–µ–Ω:', userId);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    if (savedFirstName && savedLastName) {
                        console.log('–ù–∞–π–¥–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', { firstName: savedFirstName, lastName: savedLastName });
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    console.log('üîç –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage:', {
                        user_id: userId,
                        user_first_name: savedFirstName,
                        user_last_name: savedLastName,
                        user_phone: localStorage.getItem('user_phone')
                    });
                    
                    console.log('üìã –í—Å–µ –∫–ª—é—á–∏ –≤ localStorage:', Object.keys(localStorage));
                    console.log('üìã –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è user_* –≤ localStorage:', {
                        user_id: localStorage.getItem('user_id'),
                        user_phone: localStorage.getItem('user_phone'),
                        user_first_name: localStorage.getItem('user_first_name'),
                        user_last_name: localStorage.getItem('user_last_name'),
                        user_access_token: localStorage.getItem('user_access_token')
                    });
                    
                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å ID, –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î
                    if (!savedFirstName && !savedLastName) {
                        console.log('üîÑ –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ localStorage, –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î...');
                        loadUserDataFromDB(userId);
                    }
                }
                
                const allFilled = Array.from($inputs).every(input => input.value.trim() !== '');
                if (allFilled) {
                    $submitBtn.addClass('main__btn-active');
                }
                
                // –õ–æ–≥–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã
                console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', {
                    firstName: $('#firstName').val(),
                    lastName: $('#lastName').val(),
                    allFilled: allFilled,
                    submitBtnActive: $submitBtn.hasClass('main__btn-active')
                });

                // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
                document.getElementById('nameForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
                    const submitBtn = document.querySelector('.main__btn');
                    if (submitBtn.disabled) {
                        return;
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä
                    const $spinner = $(submitBtn).find('.spinner');
                    const $btnText = $(submitBtn).find('.btn-text');
                    
                    $spinner.show();
                    $btnText.text('–û—Ç–ø—Ä–∞–≤–∫–∞...');
                    submitBtn.disabled = true;
                    
                    let firstName = document.getElementById('firstName').value;
                    let lastName = document.getElementById('lastName').value;
                    
                    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
                    firstName = firstName.trim();
                    lastName = lastName.trim();
                    
                    if (!firstName || !lastName || firstName === '' || lastName === '') {
                        showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
                    if (firstName.length < 2 || lastName.length < 2) {
                        showError('–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
                    if (firstName.length > 50 || lastName.length > 50) {
                        showError('–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã)
                    const nameRegex = /^[–∞-—è—ëa-z\s\-]+$/i;
                    if (!nameRegex.test(firstName) || !nameRegex.test(lastName)) {
                        showError('–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã');
                        return;
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                    localStorage.setItem('user_first_name', firstName);
                    localStorage.setItem('user_last_name', lastName);
                    
                    console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', {
                        user_first_name: firstName,
                        user_last_name: lastName,
                        user_id: localStorage.getItem('user_id'),
                        user_phone: localStorage.getItem('user_phone')
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
                    setTimeout(() => {
                        const savedFirstName = localStorage.getItem('user_first_name');
                        const savedLastName = localStorage.getItem('user_last_name');
                        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', {
                            savedFirstName: savedFirstName,
                            savedLastName: savedLastName
                        });
                    }, 100);
                    
                    // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
                    const userId = localStorage.getItem('user_id');
                    
                    console.log('ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage:', userId);
                    console.log('–¢–∏–ø ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', typeof userId);
                    
                    if (!userId) {
                        showError('–û—à–∏–±–∫–∞: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.');
                        return;
                    }
                    
                    // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ ID - —ç—Ç–æ —á–∏—Å–ª–æ
                    const userIdNum = parseInt(userId);
                    if (isNaN(userIdNum)) {
                        showError('–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.');
                        return;
                    }
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
                    const requestData = {
                        first_name: firstName,
                        last_name: lastName,
                        user_id: userIdNum
                    };
                    
                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', requestData);
                    console.log('üìã JSON —Å—Ç—Ä–æ–∫–∞:', JSON.stringify(requestData));
                    
                    fetch('/api/user/update-profile', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    })
                    .then(response => {
                        console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response);
                        console.log('–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status);
                        console.log('OK —Å—Ç–∞—Ç—É—Å:', response.ok);
                        
                        if (!response.ok) {
                            throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å. –°—Ç–∞—Ç—É—Å: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω:', data);
                        console.log('–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö:', typeof data);
                        console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ localStorage:', {
                            user_first_name: firstName,
                            user_last_name: lastName
                        });
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
                        if (data.success) {
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                            showSuccess('–ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω! –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...');
                            
                            // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                            console.log('üöÄ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É /user/profile');
                            console.log('üìã –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ localStorage:', {
                                user_first_name: localStorage.getItem('user_first_name'),
                                user_last_name: localStorage.getItem('user_last_name'),
                                user_id: localStorage.getItem('user_id')
                            });
                            
                            setTimeout(() => {
                                window.location.href = '/user/profile';
                            }, 1000);
                        } else {
                            throw new Error(data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
                        }
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:', error);
                        console.error('–¢–∏–ø –æ—à–∏–±–∫–∏:', typeof error);
                        console.error('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error.stack);
                        
                        let errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è';
                        if (error.message) {
                            errorMessage = error.message;
                        }
                        
                        showError(errorMessage);
                    })
                    .finally(() => {
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
                        const submitBtn = document.querySelector('.main__btn');
                        const $spinner = $(submitBtn).find('.spinner');
                        const $btnText = $(submitBtn).find('.btn-text');
                        
                        submitBtn.disabled = false;
                        $spinner.hide();
                        $btnText.text('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å');
                    });
                });

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
                function showError(message) {
                    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –æ—à–∏–±–∫–æ–π, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                    if (!$('#error-message').length) {
                        $('<div>').attr('id', 'error-message')
                            .css({
                                'color': 'red',
                                'margin-bottom': '15px',
                                'text-align': 'center'
                            })
                            .insertBefore($('#nameForm'));
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                    $('#error-message').text(message).show();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        $('#error-message').hide();
                    }, 3000);
                }
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
                function showSuccess(message) {
                    // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —É—Å–ø–µ—Ö–æ–º, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                    if (!$('#success-message').length) {
                        $('<div>').attr('id', 'success-message')
                            .css({
                                'color': 'green',
                                'margin-bottom': '15px',
                                'text-align': 'center'
                            })
                            .insertBefore($('#nameForm'));
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                    $('#success-message').text(message).show();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        $('#success-message').hide();
                    }, 3000);
                }
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
                async function loadUserDataFromDB(userId) {
                    try {
                        console.log('üì° –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –¥–ª—è ID:', userId);
                        
                        const response = await fetch(`/api/user/profile/${userId}`);
                        if (response.ok) {
                            const userData = await response.json();
                            console.log('üì• –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î:', userData);
                            
                            if (userData.first_name && userData.last_name) {
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                                localStorage.setItem('user_first_name', userData.first_name);
                                localStorage.setItem('user_last_name', userData.last_name);
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã
                                $('#firstName').val(userData.first_name);
                                $('#lastName').val(userData.last_name);
                                
                                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ë–î –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ —Ñ–æ—Ä–º—É:', `${userData.first_name} ${userData.last_name}`);
                            }
                        } else {
                            console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î, —Å—Ç–∞—Ç—É—Å:', response.status);
                        }
                    } catch (error) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î:', error);
                    }
                }
            });
        </script>
    </body>
</html>
