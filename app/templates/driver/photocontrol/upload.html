<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</title>
        <link rel="stylesheet"
            href="{{ url_for('static', path='/driver/assets/scss/main.css') }}">
        <style>
        body {
            font-weight: 400;
            color: #606060;
        }
        
        .photo-upload-section {
            margin-bottom: 30px;
        }
        
        .photo-upload-title {
            font-weight: 400;
            margin-bottom: 12px;
            color: #606060;
        }
        
        .photo-upload-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .photo-upload-item {
            width: 100%;
            background-color: #f5f5f5;
            padding: 20px;
            border: 1px dashed #cccccc;
            border-radius: 0;
            position: relative;
        }
        
        .photo-upload-item input[type="file"] {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .photo-preview {
            width: 100%;
            height: 200px;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            margin-bottom: 10px;
            display: none;
        }
        
        .photo-placeholder {
            text-align: center;
            padding: 30px 0;
        }
        
        .photo-placeholder img {
            width: 48px;
            height: 48px;
            margin-bottom: 10px;
        }
        
        .photo-placeholder p {
            margin: 0;
            color: #606060;
        }
        
        .upload-progress {
            height: 4px;
            background-color: #e0e0e0;
            width: 100%;
            margin-top: 10px;
            display: none;
        }
        
        .upload-progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        
        .upload-status {
            display: none;
            margin-top: 5px;
            font-size: 12px;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .submit-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            margin-top: 20px;
            width: 100%;
            text-align: center;
            cursor: pointer;
            font-weight: 400;
            border-radius: 0;
        }
        
        .submit-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        /* –ë–ª–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π */
        .instructions-block {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 3px solid #4CAF50;
        }
        
        .instructions-block h4 {
            margin-top: 0;
            font-weight: 400;
            color: #606060;
        }
        
        .instructions-block ul {
            padding-left: 20px;
        }
        
        .instructions-block li {
            margin-bottom: 5px;
            color: #606060;
        }
    </style>
    </head>
    <body>
        <main>
            <div class="settings">
                <div class="settings__header">
                    <a href="/driver/photocontrol/1">
                        <div class="profile__back">
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/prev_profile.svg') }}"
                                alt="back">
                        </div>
                    </a>
                </div>

                <div class="title-left">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</div>

                <div class="instructions-block">
                    <h4>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º:</h4>
                    <ul>
                        <li>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–∏–º–∏ –∏ —Ö–æ—Ä–æ—à–æ
                            –æ—Å–≤–µ—â–µ–Ω–Ω—ã–º–∏</li>
                        <li>–í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ–º—ã</li>
                        <li>–î–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω—ã
                            –ø–æ–ª–Ω–æ—Å—Ç—å—é</li>
                        <li>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ - –Ω–µ –º–µ–Ω–µ–µ 800x600
                            –ø–∏–∫—Å–µ–ª–µ–π</li>
                    </ul>
                </div>

                <form id="photoUploadForm">
                    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞ -->
                    <div class="photo-upload-section">
                        <h3 class="photo-upload-title">–ü–∞—Å–ø–æ—Ä—Ç</h3>

                        <div class="photo-upload-container">
                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="passport_front_preview"></div>
                                <div class="photo-placeholder"
                                    id="passport_front_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞</p>
                                </div>
                                <div class="upload-progress"
                                    id="passport_front_progress">
                                    <div class="upload-progress-bar"
                                        id="passport_front_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="passport_front_status"></div>
                                <input type="file" accept="image/*"
                                    id="passport_front" name="passport_front">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="passport_back_preview"></div>
                                <div class="photo-placeholder"
                                    id="passport_back_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞</p>
                                </div>
                                <div class="upload-progress"
                                    id="passport_back_progress">
                                    <div class="upload-progress-bar"
                                        id="passport_back_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="passport_back_status"></div>
                                <input type="file" accept="image/*"
                                    id="passport_back" name="passport_back">
                            </div>
                        </div>
                    </div>

                    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è -->
                    <div class="photo-upload-section">
                        <h3 class="photo-upload-title">–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ
                            —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ</h3>

                        <div class="photo-upload-container">
                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="license_front_preview"></div>
                                <div class="photo-placeholder"
                                    id="license_front_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–õ–∏—Ü–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –í–£</p>
                                </div>
                                <div class="upload-progress"
                                    id="license_front_progress">
                                    <div class="upload-progress-bar"
                                        id="license_front_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="license_front_status"></div>
                                <input type="file" accept="image/*"
                                    id="license_front" name="license_front">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="license_back_preview"></div>
                                <div class="photo-placeholder"
                                    id="license_back_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –í–£</p>
                                </div>
                                <div class="upload-progress"
                                    id="license_back_progress">
                                    <div class="upload-progress-bar"
                                        id="license_back_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="license_back_status"></div>
                                <input type="file" accept="image/*"
                                    id="license_back" name="license_back">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="driver_with_license_preview"></div>
                                <div class="photo-placeholder"
                                    id="driver_with_license_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–í–æ–¥–∏—Ç–µ–ª—å —Å –í–£ –≤ —Ä—É–∫–∞—Ö</p>
                                </div>
                                <div class="upload-progress"
                                    id="driver_with_license_progress">
                                    <div class="upload-progress-bar"
                                        id="driver_with_license_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="driver_with_license_status"></div>
                                <input type="file" accept="image/*"
                                    id="driver_with_license" name="driver_with_license">
                            </div>
                        </div>
                    </div>

                    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è -->
                    <div class="photo-upload-section">
                        <h3 class="photo-upload-title">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                            –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h3>

                        <div class="photo-upload-container">
                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="car_front_preview"></div>
                                <div class="photo-placeholder"
                                    id="car_front_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å–ø–µ—Ä–µ–¥–∏</p>
                                </div>
                                <div class="upload-progress"
                                    id="car_front_progress">
                                    <div class="upload-progress-bar"
                                        id="car_front_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="car_front_status"></div>
                                <input type="file" accept="image/*"
                                    id="car_front" name="car_front">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="car_back_preview"></div>
                                <div class="photo-placeholder"
                                    id="car_back_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å–∑–∞–¥–∏</p>
                                </div>
                                <div class="upload-progress"
                                    id="car_back_progress">
                                    <div class="upload-progress-bar"
                                        id="car_back_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="car_back_status"></div>
                                <input type="file" accept="image/*"
                                    id="car_back" name="car_back">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="car_right_preview"></div>
                                <div class="photo-placeholder"
                                    id="car_right_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å–ø—Ä–∞–≤–∞</p>
                                </div>
                                <div class="upload-progress"
                                    id="car_right_progress">
                                    <div class="upload-progress-bar"
                                        id="car_right_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="car_right_status"></div>
                                <input type="file" accept="image/*"
                                    id="car_right" name="car_right">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="car_left_preview"></div>
                                <div class="photo-placeholder"
                                    id="car_left_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å–ª–µ–≤–∞</p>
                                </div>
                                <div class="upload-progress"
                                    id="car_left_progress">
                                    <div class="upload-progress-bar"
                                        id="car_left_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="car_left_status"></div>
                                <input type="file" accept="image/*"
                                    id="car_left" name="car_left">
                            </div>
                        </div>
                    </div>

                    <!-- –ë–ª–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Å–∞–ª–æ–Ω–∞ -->
                    <div class="photo-upload-section">
                        <h3 class="photo-upload-title">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–∞–ª–æ–Ω–∞</h3>

                        <div class="photo-upload-container">
                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="interior_front_preview"></div>
                                <div class="photo-placeholder"
                                    id="interior_front_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–°–∞–ª–æ–Ω —Å–ø–µ—Ä–µ–¥–∏</p>
                                </div>
                                <div class="upload-progress"
                                    id="interior_front_progress">
                                    <div class="upload-progress-bar"
                                        id="interior_front_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="interior_front_status"></div>
                                <input type="file" accept="image/*"
                                    id="interior_front" name="interior_front">
                            </div>

                            <div class="photo-upload-item">
                                <div class="photo-preview"
                                    id="interior_back_preview"></div>
                                <div class="photo-placeholder"
                                    id="interior_back_placeholder">
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/image-placeholder.svg') }}"
                                        alt="–ó–∞–≥—Ä—É–∑–∏—Ç—å">
                                    <p>–°–∞–ª–æ–Ω —Å–∑–∞–¥–∏</p>
                                </div>
                                <div class="upload-progress"
                                    id="interior_back_progress">
                                    <div class="upload-progress-bar"
                                        id="interior_back_progress_bar"></div>
                                </div>
                                <div class="upload-status"
                                    id="interior_back_status"></div>
                                <input type="file" accept="image/*"
                                    id="interior_back" name="interior_back">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="submit-button"
                        id="submitButton" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
                </form>
            </div>
        </main>

        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('photoUploadForm');
            const submitButton = document.getElementById('submitButton');
            const photoInputs = form.querySelectorAll('input[type="file"]');
            const requiredPhotos = ['passport_front', 'passport_back', 'license_front', 'license_back', 'driver_with_license'];
            const uploadedFiles = {};
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ
            function handleFileSelect(event) {
                const fileInput = event.target;
                const fileId = fileInput.id;
                const previewElement = document.getElementById(`${fileId}_preview`);
                const placeholderElement = document.getElementById(`${fileId}_placeholder`);
                const progressElement = document.getElementById(`${fileId}_progress`);
                const statusElement = document.getElementById(`${fileId}_status`);
                
                if (fileInput.files && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏
                    progressElement.style.display = 'block';
                    statusElement.style.display = 'block';
                    statusElement.textContent = '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...';
                    
                    reader.onload = function(e) {
                        previewElement.style.backgroundImage = `url('${e.target.result}')`;
                        previewElement.style.display = 'block';
                        placeholderElement.style.display = 'none';
                        
                        // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                        simulateUpload(fileId, file);
                    };
                    
                    reader.readAsDataURL(file);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
                checkSubmitButtonState();
            }
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            function simulateUpload(fileId, file) {
                const progressBar = document.getElementById(`${fileId}_progress_bar`);
                const statusElement = document.getElementById(`${fileId}_status`);
                let progress = 0;
                
                const interval = setInterval(() => {
                    progress += 5;
                    progressBar.style.width = `${progress}%`;
                    statusElement.textContent = `–ó–∞–≥—Ä—É–∑–∫–∞: ${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        statusElement.textContent = '–ó–∞–≥—Ä—É–∂–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ';
                        uploadedFiles[fileId] = true;
                        checkSubmitButtonState();
                    }
                }, 100);
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
            function checkSubmitButtonState() {
                const allRequiredUploaded = requiredPhotos.every(id => uploadedFiles[id]);
                submitButton.disabled = !allRequiredUploaded;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
            photoInputs.forEach(input => {
                input.addEventListener('change', handleFileSelect);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
                const formData = new FormData();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ FormData
                console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:');
                photoInputs.forEach(input => {
                    if (input.files && input.files[0]) {
                        console.log(`  ${input.name}: ${input.files[0].name}`);
                        formData.append(input.name, input.files[0]);
                    } else {
                        console.log(`  ${input.name}: –ù–ï –í–´–ë–†–ê–ù`);
                    }
                });
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ fetch API
                fetch('/api/driver/upload-photos', {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –û–Ω–∏ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.');
                        window.location.href = '/driver/photocontrol/1';
                    } else {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: ' + data.detail);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                });
            });
        });
    </script>
    </body>
</html>