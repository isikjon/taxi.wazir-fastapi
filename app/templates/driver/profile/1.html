<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>–ü—Ä–æ—Ñ–∏–ª—å - Wazir.kg</title>
        <link rel="stylesheet"
            href="{{ url_for('static', path='/driver/assets/scss/main.css') }}">
        <style>
            .profile__date-selector {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin: 10px 0;
            }
            
            .profile__date-selector button {
                background: none;
                border: none;
                font-size: 18px;
                cursor: pointer;
                padding: 0 10px;
            }
            
            .profile__date-selector span {
                font-weight: bold;
            } 
            
            .profile__days {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 5px;
                margin-top: 10px;
            }
            
            .profile__days-item {
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .profile__days-item:hover {
                background-color: rgba(0, 0, 0, 0.05);
            }
            
            .calendar-wrapper {
                margin: 5px 0 15px 0;
                border: 1px solid #eaeaea;
                border-radius: 10px;
                padding: 10px;
                box-sizing: border-box;
            }
            
            .calendar-header {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                margin-bottom: 10px;
                text-align: center;
                font-size: 14px;
                color: #666;
            }
            
            .calendar-carousel {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }
            
            .calendar-day {
                aspect-ratio: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                border-radius: 50%;
                font-size: 16px;
                transition: all 0.2s ease;
                width: 35px;
                height: 35px;
                margin: 0 auto;
            }
            
            .calendar-day:hover {
                background-color: #f0f0f0;
            }
            
            .calendar-day.active {
                background-color: #333;
                color: white;
                font-weight: bold;
            }
            
            .calendar-day.today {
                border: 1px solid #999;
            }
            
            .calendar-day.other-month {
                color: #ccc;
            }
            
            .calendar-day.future {
                color: #ccc;
                cursor: not-allowed;
                opacity: 0.6;
            }
            
            .profile__balance {
                margin-top: 15px;
            }
            
            .profile__balance-active {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
            }
            
            .profile__balance-active h3 {
                font-size: 18px;
                margin: 0;
            }
            
            .profile__balance-active p {
                color: #666;
                margin: 0;
            }
            
            .profile__balance-order {
                text-align: center;
                color: #666;
                margin: 10px 0;
            }
            
            .profile__order-wrapper {
                margin-top: 15px;
            }
            
            .profile__order-info-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
            }
            
            .profile__balance-block {
                background-color: #FEF3F3;
                border: 1px solid #E73B3B;
                border-radius: 10px;
                padding: 10px 15px;
                margin: 15px 0;
                text-align: center;
            }
            
            .profile__balance-sum {
                margin-bottom: 5px;
            }
            
            .profile__balance-sum h3 {
                font-size: 20px;
                font-weight: bold;
                margin: 0;
                display: inline-block;
            }
            
            .profile__balance-sum p {
                font-size: 14px;
                color: #666;
                margin: 0;
                display: inline-block;
                margin-left: 5px;
            }
            
            .profile__balance-message {
                color: #666;
                font-size: 14px;
                margin-top: 10px;
            }
            
            /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ */
            .profile__balance-box {
                border: 1px solid #eaeaea;
                background-color: #f9f9f9;
                border-radius: 10px;
                padding: 15px;
                margin: 15px 0;
                text-align: center;
            }
            
            .balance-info {
                margin-bottom: 5px;
            }
            
            .balance-value {
                font-size: 20px;
                font-weight: bold;
                margin-right: 5px;
                padding: 5px 10px;
                border-radius: 5px;
                display: inline-block;
            }
            
            .orders-count {
                font-size: 16px;
                color: #666;
                font-weight: normal;
            }
            
            .balance-message {
                color: #666;
                font-size: 14px;
                margin-top: 10px;
            }
            
            /* –ü—Ä–æ—Ñ–∏–ª—å –∏ –∏–Ω—Ñ–æ –æ –º–∞—à–∏–Ω–µ */
            .profile__name {
                text-align: center;
                margin-bottom: 15px;
            }
            
            .profile__name h1 {
                font-size: 22px;
                margin-bottom: 5px;
                margin-top: 0;
            }
            
            .profile__name p {
                margin: 5px 0;
                color: #666;
                font-size: 14px;
            }
            
            .car-info {
                font-weight: bold;
            }
            
            .park-info {
                color: #555;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –æ—à–∏–±–æ–∫ */
            .issues-badge {
                background-color: #E73B3B;
                color: white;
                font-size: 12px;
                font-weight: bold;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: auto;
                margin-right: 10px;
            }
            
            /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ */
            .profile__action-item {
                display: flex;
                align-items: center;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–Ω—é */
            .inactive-item {
                opacity: 0.5;
                cursor: default;
            }
        </style>
    </head>
    <body data-driver-id="{{ driver_id }}">
        <main>
            <section class="profile">
                <div class="container">
                    <div class="profile__header">
                        <div class="profile__back">
                            <!-- –£–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ù–∞–∑–∞–¥ –∏ –∫–Ω–æ–ø–∫—É –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                        </div>
                        <div class="profile__stats">
                            <div class="profile__stat-item">
                                <span>0</span>
                                <p>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                            </div>
                            <div class="profile__avatar inactive-item">
                                <div>
                                    <img
                                        src="{{ url_for('static', path='/driver/assets/img/ico/profile.svg') }}"
                                        alt="profile">
                                </div>
                            </div>
                            <div class="profile__stat-item">
                                <span>0</span>
                                <p>–†–µ–π—Ç–∏–Ω–≥</p>
                            </div>
                        </div>

                        <div class="profile__name">
                            <h1 class="title">{{
                                driver.full_name|default('Evgeniy Prigojhin')
                                }}</h1>
                            <p class="car-info">{% if driver and driver.car %}{{
                                driver.car.brand|default('Toyota') }} {{
                                driver.car.model|default('Land Cruiser') }}, {{
                                driver.car.license_plate|default('02 222 ZZZ')
                                }}{% elif
                                car %}{{ car.brand|default('Toyota') }} {{
                                car.model|default('Land Cruiser') }}, {{
                                car.license_plate|default('02 222 ZZZ') }}{%
                                else
                                %}Toyota Land Cruiser, 02 222 ZZZ{% endif %}</p>
                            <p class="park-info">{{
                                driver.taxi_park|default('–û–û–û –¢—É–º–∞—Ä –¢–∞–∫—Å–∏')
                                }}</p>
                        </div>

                        <div class="profile__calendar">
                            <div class="profile__today">
                                <h3>–°–µ–≥–æ–¥–Ω—è</h3>
                                <div class="profile__date-selector">
                                    <button class="prev-week">&lt;</button>
                                    <span id="currentMonth">–ú–∞–π 2025</span>
                                    <button class="next-week">&gt;</button>
                                </div>
                            </div>
                            <div class="calendar-wrapper">
                                <div class="calendar-header">
                                    <div>–ü–Ω</div>
                                    <div>–í—Ç</div>
                                    <div>–°—Ä</div>
                                    <div>–ß—Ç</div>
                                    <div>–ü—Ç</div>
                                    <div>–°–±</div>
                                    <div>–í—Å</div>
                                </div>
                                <div class="calendar-carousel"
                                    id="calendarCarousel">
                                    <!-- –î–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </div>
                            </div>
                            <div class="profile__balance-box">
                                <div class="balance-info">
                                    <span class="balance-value"
                                        id="balance-value">0.0 —Å–æ–º</span><span
                                        class="orders-count" id="orders-count">0
                                        –∑–∞–∫–∞–∑–æ–≤</span>
                                </div>
                                <div class="balance-message">
                                    <p id="no-trips-message">–ó–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
                                        –ø–æ–µ–∑–¥–æ–∫ –Ω–µ –±—ã–ª–æ</p>
                                </div>
                            </div>
                            
                            <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å -->
                            <div id="daily-orders" style="margin-top: 15px; display: none;">
                                <h4 style="margin: 10px 0; font-size: 14px; color: #666;">üìã –ó–∞–∫–∞–∑—ã –∑–∞ –¥–µ–Ω—å</h4>
                                <div id="orders-list"></div>
                            </div>
                            <div class="profile__order-wrapper">
                                <div class="profile__order-item">
                                    <div class="profile__order-info-item">
                                        <p>–ü–æ –±–µ–∑–Ω–∞–ª—É</p>
                                        <span id="payment-card">0 —Å–æ–º</span>
                                    </div>
                                    <div class="profile__order-info-item">
                                        <p>–ù–∞–ª–∏—á–Ω—ã–º–∏</p>
                                        <span id="payment-cash">0 —Å–æ–º</span>
                                    </div>
                                    <div class="profile__order-info-item">
                                        <p>–°–µ—Ä–≤–∏—Å (–≤—ã—á–µ—Ç—ã)</p>
                                        <span id="payment-service">0 —Å–æ–º
                                            (0%)</span>
                                    </div>
                                    <div class="profile__order-info-item">
                                        <p>–ü–∞—Ä–∫ (–≤—ã—á–µ—Ç—ã)</p>
                                        <span id="payment-park">0 —Å–æ–º
                                            (0%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="profile__actions">
                        <a href="/driver/online?driver_id={{ driver_id }}" style="text-decoration: none;">
                            <button class="main__btn main__btn-active" style="margin-bottom: 20px; font-weight: 400;">
                                –ù–∞ –ª–∏–Ω–∏—é
                            </button>
                        </a>
                        <a href="{{ url_for('driver_balance_page') }}">
                            <div class="profile__action-item">
                                <p>–ë–∞–ª–∞–Ω—Å</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <div class="profile__action-item inactive-item">
                            <p>–û–ø–ª–∞—Ç–∞</p>
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                alt="next">
                        </div>
                        <a href="{{ url_for('driver_data_page') }}">
                            <div class="profile__action-item">
                                <p>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∞—Å</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <a href="/driver/activity">
                            <div class="profile__action-item">
                                <p>–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                    </div>

                    <div class="profile__actions">
                        <h3 class="title-left">–¢–∞—Ä–∏—Ñ—ã –∏ –æ–ø—Ü–∏–∏</h3>
                        <a
                            href="{{ url_for('driver_tarifs') }}">
                            <div class="profile__action-item">
                                <p>–¢–∞—Ä–∏—Ñ—ã</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <a
                            href="{{ url_for('driver_tarif_options') }}">
                            <div class="profile__action-item">
                                <p>–û–ø—Ü–∏–∏ –¥–ª—è —Ç–∞—Ä–∏—Ñ–æ–≤</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <a
                            href="{{ url_for('driver_support') }}">
                            <div class="profile__action-item">
                                <p>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <a
                            href="/driver/diagnostics/1">
                            <div class="profile__action-item">
                                <p>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</p>
                                {% if issues_count > 0 %}
                                <div class="issues-badge">{{ issues_count
                                    }}</div>
                                {% endif %}
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <a
                            href="{{ url_for('driver_photocontrol') }}">
                            <div class="profile__action-item">
                                <p>–§–æ—Ç–æ–∫–æ–Ω—Ç—Ä–æ–ª—å</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <div class="profile__action-item inactive-item">
                            <p>–ü—Ä–æ–º–æ–∫–æ–¥—ã</p>
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                alt="next">
                        </div>
                        <div class="profile__action-item inactive-item">
                            <p>–û—Ç –±–æ—Ä—Ç–∞</p>
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                alt="next">
                        </div>
                        <div class="profile__action-item inactive-item">
                            <p>–°–æ–æ–±—â–µ–Ω–∏—è</p>
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                alt="next">
                        </div>
                        <a
                            href="{{ url_for('driver_board') }}">
                            <div class="profile__action-item">
                                <p>–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                        <div class="profile__action-item inactive-item">
                            <p>–í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</p>
                            <img
                                src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                alt="next">
                        </div>
                        <a href="{{ url_for('driver_logout') }}">
                            <div class="profile__action-item">
                                <p>–í—ã—Ö–æ–¥ –∏–∑ Wazir</p>
                                <img
                                    src="{{ url_for('static', path='/driver/assets/img/ico/next.svg') }}"
                                    alt="next">
                            </div>
                        </a>
                    </div>
                </div>
            </section>
        </main>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // –ü–æ–ª—É—á–∞–µ–º ID –≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ data-driver-id
                window.driverId = document.body.dataset.driverId;
                console.log('ID –≤–æ–¥–∏—Ç–µ–ª—è:', window.driverId);
                
                // –§–ª–∞–≥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
                let isFirstRun = true;
                
                // –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –¥–∞—Ç—É
                const today = new Date(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É —Å–∏—Å—Ç–µ–º—ã
                console.log("–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞:", today.toDateString());
                
                let selectedDate = new Date(today);
                let currentWeekStart = getWeekStart(today); // –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
                
                console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è:");
                console.log("- –°–µ–≥–æ–¥–Ω—è:", today.toDateString());
                console.log("- –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:", currentWeekStart.toDateString());
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
                updateCalendar();
                
                // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
                getBalanceFromAdminPanel();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ 
                const updateInterval = setInterval(getBalanceFromAdminPanel, 5000);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–¥–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.addEventListener('beforeunload', () => {
                    clearInterval(updateInterval);
                });
                
                // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏
                window.updateDriverBalance = function(newBalance) {
                    document.getElementById('balance-value').textContent = `${newBalance} —Å–æ–º`;
                    showBalanceUpdateAnimation();
                    console.log(`–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é: ${newBalance} —Å–æ–º`);
                    return true;
                };
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º
                document.querySelector('.prev-week').addEventListener('click', function() {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏)
                    const newWeekStart = new Date(currentWeekStart);
                    newWeekStart.setDate(newWeekStart.getDate() - 7);
                    
                    console.log("–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –Ω–µ–¥–µ–ª—é:");
                    console.log("- –¢–µ–∫—É—â–µ–µ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:", currentWeekStart.toDateString());
                    console.log("- –ù–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:", newWeekStart.toDateString());
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                    currentWeekStart = newWeekStart;
                    updateCalendar();
                });
                
                document.querySelector('.next-week').addEventListener('click', function() {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–∏
                    const newWeekStart = new Date(currentWeekStart);
                    newWeekStart.setDate(newWeekStart.getDate() + 7);
                    
                    // –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã)
                    const todayWeekStart = getWeekStart(today);
                    
                    console.log("–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é:");
                    console.log("- –¢–µ–∫—É—â–µ–µ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:", currentWeekStart.toDateString());
                    console.log("- –ù–æ–≤–æ–µ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏:", newWeekStart.toDateString());
                    console.log("- –ù–∞—á–∞–ª–æ —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏ (—Å–µ–≥–æ–¥–Ω—è):", todayWeekStart.toDateString());
                    
                    // –ï—Å–ª–∏ –Ω–æ–≤–∞—è –Ω–µ–¥–µ–ª—è –Ω–µ –ø–æ–∑–∂–µ —Ç–µ–∫—É—â–µ–π (–Ω–µ –≤ –±—É–¥—É—â–µ–º)
                    if (newWeekStart.getTime() <= todayWeekStart.getTime()) {
                        currentWeekStart = newWeekStart;
                        updateCalendar();
                    } else {
                        console.log("–û—Ç–∫–∞–∑: –ø–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –±—É–¥—É—â–µ–µ");
                    }
                });
                
                // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
                function getWeekStart(dateInput) {
                    const date = new Date(dateInput);
                    const day = date.getDay(); // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ, 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, ...
                    
                    // –°–¥–≤–∏–≥ –¥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
                    // –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (0), –æ—Ç–Ω–∏–º–∞–µ–º 6 –¥–Ω–µ–π –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
                    // –ò–Ω–∞—á–µ –æ—Ç–Ω–∏–º–∞–µ–º (day - 1) –¥–Ω–µ–π
                    const daysToSubtract = day === 0 ? 6 : day - 1;
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É - –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - daysToSubtract);
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –¥–æ 00:00:00
                    weekStart.setHours(0, 0, 0, 0);
                    
                    return weekStart;
                }
                
                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
                function updateCalendar() {
                    const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', 
                                       '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å —Ç–µ–∫—É—â–∏–º –º–µ—Å—è—Ü–µ–º –∏ –≥–æ–¥–æ–º
                    document.getElementById('currentMonth').textContent = 
                        `${monthNames[currentWeekStart.getMonth()]} ${currentWeekStart.getFullYear()}`;
                    
                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                    const calendarCarousel = document.getElementById('calendarCarousel');
                    calendarCarousel.innerHTML = '';
                    
                    // –°–æ–∑–¥–∞–µ–º –¥–Ω–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏
                    for (let i = 0; i < 7; i++) {
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –¥–∞—Ç—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
                        const date = new Date(currentWeekStart);
                        date.setDate(date.getDate() + i);
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                        date.setHours(0, 0, 0, 0);
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –¥–µ–Ω—å –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—è—Ü–µ
                        const isOtherMonth = date.getMonth() !== currentWeekStart.getMonth();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å —Ç–µ–∫—É—â–∏–º
                        const isToday = date.toDateString() === today.toDateString();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å –≤—ã–±—Ä–∞–Ω–Ω—ã–º
                        const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–µ–Ω—å –±—É–¥—É—â–∏–º
                        const isFuture = date > today;
                        
                        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–Ω—è
                        const dayEl = document.createElement('div');
                        dayEl.className = 'calendar-day';
                        dayEl.dataset.date = date.toISOString(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞—Ç—É –≤ –∞—Ç—Ä–∏–±—É—Ç–µ
                        
                        if (isOtherMonth) dayEl.classList.add('other-month');
                        if (isSelected) dayEl.classList.add('active');
                        if (isToday) dayEl.classList.add('today');
                        if (isFuture) dayEl.classList.add('future');
                        
                        dayEl.textContent = date.getDate();
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—à–ª—ã—Ö –∏ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
                        if (!isFuture) {
                            dayEl.addEventListener('click', function() {
                                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –¥–Ω–µ–π
                                document.querySelectorAll('.calendar-day').forEach(el => {
                                    el.classList.remove('active');
                                });
                                
                                // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å
                                this.classList.add('active');
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞
                                selectedDate = new Date(this.dataset.date);
                                
                                console.log("–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞:", selectedDate.toDateString());
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
                                updateDataForDate(selectedDate);
                            });
                        }
                        
                        calendarCarousel.appendChild(dayEl);
                    }
                    
                    // –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã–±–∏—Ä–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
                    if (isFirstRun) {
                        isFirstRun = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
                        
                        const todayElem = document.querySelector('.calendar-day.today');
                        if (todayElem) {
                            todayElem.classList.add('active');
                            updateDataForDate(today);
                        }
                    }
                }
                
                // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
                function getBalanceFromAdminPanel() {
                    // –ü–æ–ª—É—á–∞–µ–º ID –≤–æ–¥–∏—Ç–µ–ª—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                    const driverId = window.driverId || document.body.dataset.driverId;
                    
                    if (!driverId) {
                        console.error('ID –≤–æ–¥–∏—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        return;
                    }
                    
                    // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                    fetch(`/api/driver/${driverId}/balance`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –±–∞–ª–∞–Ω—Å–µ');
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.success) {
                                const foundBalance = data.balance;
                                const currentBalance = extractNumberFromString(document.getElementById('balance-value').textContent);
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω–∏–ª—Å—è
                                if (currentBalance !== foundBalance) {
                                    document.getElementById('balance-value').textContent = `${foundBalance} —Å–æ–º`;
                                    showBalanceUpdateAnimation();
                                    console.log(`–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${currentBalance} -> ${foundBalance} —Å–æ–º`);
                                }
                            } else {
                                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å:', data.detail);
                            }
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:', error);
                        });
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                function showBalanceUpdateAnimation() {
                    const balanceEl = document.getElementById('balance-value');
                    balanceEl.style.transition = 'background-color 1s';
                    balanceEl.style.backgroundColor = '#ffffcc';
                    
                    setTimeout(() => {
                        balanceEl.style.backgroundColor = '';
                    }, 1000);
                }
                
                // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
                function extractNumberFromString(str) {
                    if (!str) return null;
                    
                    const match = str.match(/(\d+(\.\d+)?)/);
                    return match ? parseFloat(match[1]) : null;
                }
                
                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
                function updateDataForDate(date) {
                    console.log("–û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—Ç—ã:", date.toDateString());
                    
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
                    document.getElementById('orders-count').textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
                    document.getElementById('no-trips-message').textContent = "–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...";
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É
                    loadOrdersForDate(date);
                    
                    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                    getBalanceFromAdminPanel();
                }
                
                // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É
                function loadOrdersForDate(date) {
                    const driverId = window.driverId || document.body.dataset.driverId;
                    const dateStr = date.toISOString().split('T')[0]; // YYYY-MM-DD —Ñ–æ—Ä–º–∞—Ç
                    
                    fetch(`/api/driver/${driverId}/stats?date=${dateStr}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success || data.orders) {
                                const orders = data.orders || [];
                                const totalOrders = orders.length;
                                const totalEarnings = orders.reduce((sum, order) => sum + (parseFloat(order.price) || 0), 0);
                                
                                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
                                const completedOrders = orders.filter(o => o.status === 'completed' || o.status === '–ó–∞–≤–µ—Ä—à–µ–Ω').length;
                                const cancelledOrders = orders.filter(o => o.status === 'cancelled' || o.status === '–û—Ç–º–µ–Ω–µ–Ω').length;
                                const activeOrders = orders.filter(o => o.status === 'active' || o.status === '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è').length;
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                document.getElementById('orders-count').textContent = `${totalOrders} –∑–∞–∫–∞–∑–æ–≤`;
                                document.getElementById('balance-value').textContent = `${totalEarnings.toFixed(0)} —Å–æ–º`;
                                
                                if (totalOrders > 0) {
                                    document.getElementById('no-trips-message').textContent = 
                                        `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${completedOrders} | ‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ: ${cancelledOrders} | ‚è≥ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activeOrders}`;
                                    
                                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
                                    displayOrdersList(orders);
                                } else {
                                    document.getElementById('no-trips-message').textContent = "–ó–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ø–æ–µ–∑–¥–æ–∫ –Ω–µ –±—ã–ª–æ";
                                    document.getElementById('daily-orders').style.display = 'none';
                                }
                                
                                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –æ–ø–ª–∞—Ç (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∏)
                                document.getElementById('payment-card').textContent = "0 —Å–æ–º";
                                document.getElementById('payment-cash').textContent = `${totalEarnings.toFixed(0)} —Å–æ–º`;
                                document.getElementById('payment-service').textContent = "0 —Å–æ–º (0%)";
                                document.getElementById('payment-park').textContent = "0 —Å–æ–º (0%)";
                            } else {
                                // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                document.getElementById('orders-count').textContent = "0 –∑–∞–∫–∞–∑–æ–≤";
                                document.getElementById('no-trips-message').textContent = "–ó–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –ø–æ–µ–∑–¥–æ–∫ –Ω–µ –±—ã–ª–æ";
                                document.getElementById('daily-orders').style.display = 'none';
                            }
                        })
                        .catch(error => {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                            document.getElementById('orders-count').textContent = "0 –∑–∞–∫–∞–∑–æ–≤";
                            document.getElementById('no-trips-message').textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö";
                            document.getElementById('daily-orders').style.display = 'none';
                        });
                }
                
                // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
                function displayOrdersList(orders) {
                    const dailyOrdersContainer = document.getElementById('daily-orders');
                    const ordersListContainer = document.getElementById('orders-list');
                    
                    if (orders.length === 0) {
                        dailyOrdersContainer.style.display = 'none';
                        return;
                    }
                    
                    let ordersHtml = '';
                    orders.forEach((order, index) => {
                        const statusIcon = getStatusIcon(order.status);
                        const statusText = getStatusText(order.status);
                        
                        ordersHtml += `
                            <div style="background: #f9f9f9; border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 3px solid ${getStatusColor(order.status)};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="font-weight: 500; font-size: 14px;">${statusIcon} –ó–∞–∫–∞–∑ #${order.order_number || order.id}</div>
                                    <div style="font-size: 12px; color: #666;">${order.time || '‚Äî'}</div>
                                </div>
                                <div style="font-size: 13px; color: #444; margin-bottom: 5px;">
                                    üìç ${truncateText(order.origin || '–ù–µ —É–∫–∞–∑–∞–Ω–æ', 30)}
                                </div>
                                <div style="font-size: 13px; color: #444; margin-bottom: 8px;">
                                    üèÅ ${truncateText(order.destination || '–ù–µ —É–∫–∞–∑–∞–Ω–æ', 30)}
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="font-size: 12px; color: #666;">${statusText}</div>
                                    <div style="font-weight: bold; color: #2ecc71;">${(order.price || 0)} —Å–æ–º</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    ordersListContainer.innerHTML = ordersHtml;
                    dailyOrdersContainer.style.display = 'block';
                }
                
                // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
                function getStatusIcon(status) {
                    switch(status) {
                        case 'completed':
                        case '–ó–∞–≤–µ—Ä—à–µ–Ω':
                            return '‚úÖ';
                        case 'cancelled':
                        case '–û—Ç–º–µ–Ω–µ–Ω':
                            return '‚ùå';
                        case 'active':
                        case '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è':
                            return '‚è≥';
                        default:
                            return 'üìã';
                    }
                }
                
                function getStatusText(status) {
                    switch(status) {
                        case 'completed':
                        case '–ó–∞–≤–µ—Ä—à–µ–Ω':
                            return '–í—ã–ø–æ–ª–Ω–µ–Ω';
                        case 'cancelled':
                        case '–û—Ç–º–µ–Ω–µ–Ω':
                            return '–û—Ç–º–µ–Ω–µ–Ω';
                        case 'active':
                        case '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è':
                            return '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è';
                        default:
                            return status || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    }
                }
                
                function getStatusColor(status) {
                    switch(status) {
                        case 'completed':
                        case '–ó–∞–≤–µ—Ä—à–µ–Ω':
                            return '#2ecc71';
                        case 'cancelled':
                        case '–û—Ç–º–µ–Ω–µ–Ω':
                            return '#e74c3c';
                        case 'active':
                        case '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è':
                            return '#f39c12';
                        default:
                            return '#95a5a6';
                    }
                }
                
                function truncateText(text, maxLength) {
                    if (!text) return '';
                    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                }
            });
        </script>
    </body>
</html>